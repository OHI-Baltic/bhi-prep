<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Contaminants - Clean Water Subgoal | Baltic Health Index Data Preparation 2019</title>
  <meta name="description" content="Compiled documents on sources and preparation of data for the second Baltic Health Index assessment" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Contaminants - Clean Water Subgoal | Baltic Health Index Data Preparation 2019" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Compiled documents on sources and preparation of data for the second Baltic Health Index assessment" />
  <meta name="github-repo" content="OHI-Science/bhi-prep" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Contaminants - Clean Water Subgoal | Baltic Health Index Data Preparation 2019" />
  
  <meta name="twitter:description" content="Compiled documents on sources and preparation of data for the second Baltic Health Index assessment" />
  

<meta name="author" content="Ellie Campbell, Andrea De Cervo, Thorsten Blenckner" />


<meta name="date" content="2020-04-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="wild-caught-fisheries-food-provision-subgoal.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html"><i class="fa fa-check"></i><b>1</b> Contaminants - Clean Water Subgoal</a><ul>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#background"><i class="fa fa-check"></i>1. Background</a><ul>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#goal-description"><i class="fa fa-check"></i>1.1 Goal Description</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#model-data"><i class="fa fa-check"></i>1.2 Model &amp; Data</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#reference-points"><i class="fa fa-check"></i>1.3 Reference points</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#other-information"><i class="fa fa-check"></i>1.4 Other information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#data"><i class="fa fa-check"></i>2. Data</a><ul>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#datasets-with-sources"><i class="fa fa-check"></i>2.1 Datasets with Sources</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#centralization-normalization"><i class="fa fa-check"></i>2.2 Centralization &amp; Normalization</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#initial-data-exploration"><i class="fa fa-check"></i>2.3 Initial Data Exploration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#wrangling-evaluation-and-gapfilling"><i class="fa fa-check"></i>3. Wrangling, Evaluation, and Gapfilling</a><ul>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#pcb-indicator"><i class="fa fa-check"></i>3.1 PCB Indicator</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#pfos-indicator-1"><i class="fa fa-check"></i>3.2 PFOS Indicator</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#dioxin-indicator"><i class="fa fa-check"></i>3.3 Dioxin Indicator</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#concerning-substances-indicator"><i class="fa fa-check"></i>3.4 Concerning Substances Indicator</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#regional-monitoring-of-concerning-substances"><i class="fa fa-check"></i>3.4.1 Regional monitoring of Concerning Substances</a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#save-concerning-substances-layer-and-intermediate-datasets"><i class="fa fa-check"></i>3.4.2 Save concerning substances layer and intermediate datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#visualizing-contaminants-data-layers"><i class="fa fa-check"></i>4. Visualizing Contaminants Data Layers</a><ul>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#contaminants-data-layers-maps-subbasin-trends"><i class="fa fa-check"></i>4.1 Contaminants data layers Maps &amp; Subbasin Trends</a></li>
</ul></li>
<li><a href="contaminants-clean-water-subgoal.html#considerations-for-bhi3.0">5. Considerations for <code>BHI3.0</code></a></li>
<li class="chapter" data-level="" data-path="contaminants-clean-water-subgoal.html"><a href="contaminants-clean-water-subgoal.html#references"><i class="fa fa-check"></i>6. References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html"><i class="fa fa-check"></i><b>2</b> Wild-Caught Fisheries - Food Provision Subgoal</a><ul>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#background-1"><i class="fa fa-check"></i>1. Background</a><ul>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#goal-description-1"><i class="fa fa-check"></i>1.1 Goal Description</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#model-data-1"><i class="fa fa-check"></i>1.2 Model &amp; Data</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#reference-points-1"><i class="fa fa-check"></i>1.3 Reference points</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#other-information-1"><i class="fa fa-check"></i>1.4 Other information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#data-1"><i class="fa fa-check"></i>2. Data</a><ul>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#datasets-with-sources-1"><i class="fa fa-check"></i>2.1 Datasets with Sources</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#centralization-normalization-1"><i class="fa fa-check"></i>2.2 Centralization &amp; Normalization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#prep-wrangling-derivations-checksevaluation-gapfilling"><i class="fa fa-check"></i>3. Prep: Wrangling &amp; Derivations, Checks/Evaluation, Gapfilling</a><ul>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#reorganizingwrangling"><i class="fa fa-check"></i>3.1 Reorganizing/wrangling</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#evaluate-data-sampling-patterns"><i class="fa fa-check"></i>3.2 Evaluate data &amp; sampling patterns</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#status-and-trend"><i class="fa fa-check"></i>3.3 Status and trend</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#gapfilling"><i class="fa fa-check"></i>3.4 Gapfilling</a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#methods-discussion-3"><i class="fa fa-check"></i>3.5 Methods discussion</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#visualizing-data-layers"><i class="fa fa-check"></i>4. Visualizing Data Layers</a><ul>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#goal-status-map"><i class="fa fa-check"></i>4.1 Goal Status Map</a></li>
</ul></li>
<li><a href="wild-caught-fisheries-food-provision-subgoal.html#considerations-for-bhi3.0-1">5. Considerations for <code>BHI3.0</code></a></li>
<li class="chapter" data-level="" data-path="wild-caught-fisheries-food-provision-subgoal.html"><a href="wild-caught-fisheries-food-provision-subgoal.html#references-1"><i class="fa fa-check"></i>6. References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html"><i class="fa fa-check"></i><b>3</b> Mariculture - Food Provision Subgoal</a><ul>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#background-2"><i class="fa fa-check"></i>1. Background</a><ul>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#goal-description-2"><i class="fa fa-check"></i>1.1 Goal Description</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#model-data-2"><i class="fa fa-check"></i>1.2 Model &amp; Data</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#reference-points-2"><i class="fa fa-check"></i>Reference points</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#other-information-2"><i class="fa fa-check"></i>Other information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#data-2"><i class="fa fa-check"></i>2. Data</a><ul>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#datasets-with-sources-2"><i class="fa fa-check"></i>2.1 Datasets with Sources</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#centralization-normalization-2"><i class="fa fa-check"></i>2.2 Centralization &amp; Normalization</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#initial-data-exploration-1"><i class="fa fa-check"></i>2.3 Initial Data Exploration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#prep-wrangling-derivations-checksevaluation-gapfilling-1"><i class="fa fa-check"></i>3. Prep: Wrangling &amp; Derivations, Checks/Evaluation, Gapfilling</a><ul>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#reorganizingwrangling-1"><i class="fa fa-check"></i>3.1 Reorganizing/wrangling</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#imputationgapfilling-of-merged-datasets"><i class="fa fa-check"></i>3.2 Imputation/Gapfilling of merged datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#visualizing-data-layers-1"><i class="fa fa-check"></i>4. Visualizing Data Layers</a><ul>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#nutrient-use"><i class="fa fa-check"></i>4.1 Nutrient Use</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#timeseries-plots"><i class="fa fa-check"></i>4.2 Timeseries Plots</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#map-of-mariculture-data"><i class="fa fa-check"></i>4.3 Map of Mariculture Data</a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#gapfilling-percentages-by-country-and-region"><i class="fa fa-check"></i>4.4 Gapfilling percentages by Country and Region</a></li>
</ul></li>
<li><a href="mariculture-food-provision-subgoal.html#considerations-for-bhi3.0-2">5. Considerations for <code>BHI3.0</code></a></li>
<li class="chapter" data-level="" data-path="mariculture-food-provision-subgoal.html"><a href="mariculture-food-provision-subgoal.html#references-2"><i class="fa fa-check"></i>6. References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Baltic Health Index Data Preparation 2019</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="contaminants---clean-water-subgoal" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Contaminants - Clean Water Subgoal</h1>
<p><br></p>
<div id="background" class="section level2 unnumbered">
<h2>1. Background</h2>
<div id="goal-description" class="section level3 unnumbered">
<h3>1.1 Goal Description</h3>
<p>The Contaminant sub-goal of the Clean Water goal captures the degree to which local waters are unpolluted by contaminants. This sub-goal scores highest when the contamination level is below a threshold, which is defined by the Marine Framework Directive. For the BHI three contaminants indicators are proposed, describing different aspects of toxicity: dioxin and dioxin like compounds, polychlorinated biphenyl compounds (PCBs), and perfluorooctanesulfonic acid (PFOS). In addition, a penalty factor has been applied to account for the fact that current monitoring programs do not cover all the registered and harmful contaminants.</p>
</div>
<div id="model-data" class="section level3 unnumbered">
<h3>1.2 Model &amp; Data</h3>
<p>All contaminant data were downloaded from the open-accessible ICES database (see below).</p>
<ul>
<li><a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES Database for Contaminants in Biota (PCBs, Dioxins, PFOS, and Concerning Substances)</a></li>
<li><a href="http://dome.ices.dk/views/ContaminantsSediment.aspx">ICES Database for Contaminants in Sediment (PCBs, Dioxins, and Concerning Substances)</a></li>
<li><a href="https://vocab.ices.dk/?CodeID=26983">Reference codes for PCB Congeners</a></li>
<li><a href="https://vocab.ices.dk/?CodeID=26986">Reference codes for Dioxin Congeners</a></li>
</ul>
<p>Table to calculate the Concerning Substances indicator (penalty factor):</p>
<ul>
<li><a href="https://echa.europa.eu/candidate-list-table?p_p_id=disslists_WAR_disslistsportlet&amp;p_p_lifecycle=1&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_pos=2&amp;p_p_col_count=3&amp;_disslists_WAR_disslistsportlet_javax.portlet.action=searchDissLists">European Chemical Agency Candidate List of substances of very high concern for Authorisation</a></li>
</ul>
</div>
<div id="reference-points" class="section level3 unnumbered">
<h3>1.3 Reference points</h3>
<div id="pcb-concentration-indicator-biota" class="section level4 unnumbered">
<h4>1.3.1 PCB Concentration Indicator Biota</h4>
<p>Non-dioxin like PCBs: sum of congeners (28, 52, 101, 138, 153, 180). Target is set at the threshold of 75 ug/kg ww (wet weight) fish muscle.</p>
<p>This is similar to the ICES-7 except that PCB 118 is excluded, since it is metabolized by mammals.</p>
<p>75 ng/g wet weight is the <a href="http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2011:320:0018:0023:EN:PDF">EU threshold for fish muscle. See Section 5 Annex, 5.3</a>. This threshold was also agreed upon as GES boundary at the meeting of the <a href="http://helcom.fi/helcom-at-work/groups/state-and-conservation">Working Group on the State of the Environment and Nature Conservation</a> April 11-15, 2016. <em>Recevied the draft report from Elisabeth Nyberg.</em></p>
<p><br/></p>
</div>
<div id="teq-values-for-dioxins-and-dioxin-like-pcbs-in-biota" class="section level4 unnumbered">
<h4>1.3.2 TEQ values for Dioxins and Dioxin-like PCBs in Biota</h4>
<p>Dioxin and dioxin-like compounds. Target is set at 0.0065 TEQ ug/kg ww fish, crustaceans or molluscs (source of target: EQS biota human health). Secondary GES boundary: CB-118 24 ug/kg lw fish liver or muscle (source: EAC).</p>
<p>This threshold was agreed upon as GES indicator at the meeting of the <a href="http://helcom.fi/helcom-at-work/groups/state-and-conservation">Working Group on the State of the Environment and Nature Conservation</a> April 11-15, 2016. <em>Recevied the draft report from Elisabeth Nyberg.</em></p>
<p>This is consistent with the <a href="http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2011:320:0018:0023:EN:PDF">EU human health thresholds for dioxin and dioxin-like compounds - 6.5 pg/g</a></p>
<p>TEQ values from the <a href="http://www.who.int/ipcs/assessment/tef_values.pdf">World Health Organization 2005</a></p>
<p><br/></p>
</div>
<div id="pfos-indicator" class="section level4 unnumbered">
<h4>1.3.3 PFOS Indicator</h4>
<p>According to <a href="http://www.helcom.fi/Core%20Indicators/PFOS_HELCOM%20core%20indicator%202016_web%20version.pdf">HELCOM PFOS core indicator document, p.3</a>, the “GES boundary is set to 9.1 μg/kg wet weight (or 9.1 ng/g ww) with the protection goal of human health”.</p>
<p>“The GES boundary is an environmental quality standard (EQS), derived at EU level as a substance included on the list of priority substances under the Water Framework Directive (European Commission 2000, 2013). GES, in accordance with the MSFD is defined as ‘concentrations of contaminants at levels not giving rise to pollution effects’. EQS are derived from ecotoxicological studies to protect freshwater and marine ecosystems from potential adverse effects of chemicals, as well as adverse effects on human health via drinking water and food from aquatic environments. Quality Standards (QS) are derived for different protection goals, i.e.: pelagic and benthic communities, top-predators in these ecosystems, and human health. The most stringent of these QS is the basis for the EQS. The EQS boundary for PFOS is based on the QS set for biota to protect human health (9.1 μg/ kg fish ww), defined for edible parts in fish. For harmonization purposes the EC Guidance Document No. 32 on biota monitoring (the implementation of EQS biota) under the WFD was developed (European Commission 2014). This guidance document recommends that the results from the monitoring should be standardized to represent fish at a trophic level of 4, which is an estimate of the general trophic level in commercial fish in Europe. The recommendation to obtain PFOS data in fish at a trophic level of 4 is to adjust the values from monitoring in accordance with trophic magnification factors and trophic level.” <span class="math inline">\(-\)</span> <a href="http://www.helcom.fi/Core%20Indicators/PFOS_HELCOM%20core%20indicator%202016_web%20version.pdf">HELCOM PFOS core indicator document, p.8</a></p>
<p><strong>HELCOM core indicator report uses liver PFOS concentrations converted to muscle equivalent values</strong> as in <a href="https://www.diva-portal.org/smash/get/diva2:767385/FULLTEXT01.pdf">Faxneld et al. 2014b</a>.</p>
<p><br/></p>
</div>
<div id="teq-values-for-pcbs-in-sediment" class="section level4 unnumbered">
<h4>1.3.4 TEQ values for PCBs in Sediment</h4>
<p>Only a few environmental quality standards (EQS) are to date defined in the Baltic Sea for marine surface sediments. The Norwegian threshold values are often used when a comparison with ecotoxicological effects is needed. In particular, the <a href="https://www.miljodirektoratet.no/globalassets/publikasjoner/m1132/m1132.pdf">Norwegian Environment Agency</a> has defined EQS in sediment for 28 EU priority substances.</p>
<p>PCB7 (sum PCB 28, 52, 101, 118, 138, 153, and 180): Target is set at 4.1 TS ug/kg dw. <a href="http://www.vannportalen.no/globalassets/nasjonalt/dokumenter/veiledere-direktoratsgruppa/Klassifisering-av-miljotilstand-i-vann-02-2018.pdf">Environmental quality classification of water bodies</a></p>
<p><strong>Recommended threshold values are given only for total PCB7, and not for each individual congener. This is because toxicity data are available for only a minority of congeners.</strong></p>
<p><br/></p>
</div>
<div id="teq-values-for-dioxins-in-sediment" class="section level4 unnumbered">
<h4>1.3.5 TEQ values for Dioxins in Sediment</h4>
<p>Dioxin and dioxin-like compounds. Target is set at 0.00086 TEQ ug/kg dw (Total TEQ). <a href="https://www.miljodirektoratet.no/globalassets/publikasjoner/m1132/m1132.pdf">Norwegian Environment Agency</a> TEQ values from the <a href="http://www.who.int/ipcs/assessment/tef_values.pdf">World Health Organization 2005</a></p>
<p><br/></p>
</div>
</div>
<div id="other-information" class="section level3 unnumbered">
<h3>1.4 Other information</h3>
<p>External advisors/goalkeepers: Anna Sobek</p>
<p><br/></p>
</div>
</div>
<div id="data" class="section level2 unnumbered">
<h2>2. Data</h2>
<p>This prep document is used to generate and explore the following data layers:</p>
<ul>
<li><code>cw_con_pcb_bhi2019.csv</code></li>
<li><code>cw_con_pfos_bhi2019.csv</code></li>
<li><code>cw_con_dioxin_bhi2019.csv</code></li>
<li><code>cw_con_penalty_bhi2019.csv</code></li>
</ul>
<p>These are saved to the <code>layers</code> folder. Intermediate datasets saved to <code>data/CW/contaminants/v2019/intermediate</code> include: <code>pcb_bio_cleaned.csv</code>, <code>pcb_sed_cleaned.csv</code>, <code>pfos_bio_cleaned.csv</code>, <code>dioxin_bio_cleaned.csv</code> and <code>dioxin_sed_cleaned.csv</code>. All these are derived from or informed by the following raw datasets.</p>
<div id="datasets-with-sources" class="section level3 unnumbered">
<h3>2.1 Datasets with Sources</h3>
<p><br/></p>
<div id="pcb-data" class="section level4 unnumbered">
<h4>2.1.1 PCB Data</h4>
<strong>PCB Data in Biota</strong> <!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_PCBs/ContaminantsBiota_PCBs.csv --> <!-- w/ one year more of data...BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_PCBs/ContaminantsBiota_20Feb07_PCBs.csv -->
<table class="table" style>
<caption>
<span id="tab:unnamed-chunk-1">Table 1.1: </span>Source: <a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES Database</a> <br> Downloaded 22 April 2019 by Ellie Campbell
</caption>
<thead>
<tr>
<th style="text-align:left;">
Option
</th>
<th style="text-align:left;">
Specification
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
1990-2017
</td>
</tr>
<tr>
<td style="text-align:left;">
Purpose of monitoring
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Monitoring Program
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Parameter Group
</td>
<td style="text-align:left;">
Chlorobiphenyls
</td>
</tr>
<tr>
<td style="text-align:left;">
Reporting Laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Analytical laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Geographical Areas
</td>
<td style="text-align:left;">
(HELCOM) ALL HELCOM sub-basins
</td>
</tr>
</tbody>
</table>
<strong>PCB Congeners</strong> <!-- reference codes found here: https://vocab.ices.dk/?CodeID=26983 -->
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Data Code
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">
CB180
</td>
<td style="text-align: right;">
2,2’,3,4,4’,5,5’-heptachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
SCB7
</td>
<td style="background-color: #8d909e; text-align: right;">
sum of CBs.- Sum of
</td>
</tr>
<tr>
<td style="text-align: left;">
CB28
</td>
<td style="text-align: right;">
2,4,4’-trichlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB52
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,5,5’-tetrachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB101
</td>
<td style="text-align: right;">
2,2’,4,5,5’-pentachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB118
</td>
<td style="background-color: #8d909e; text-align: right;">
2,3’,4,4’,5-pentachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB153
</td>
<td style="text-align: right;">
2,2’,4,4’,5,5’-hexachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB138
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,4,4’,5’-hexachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
PCB
</td>
<td style="text-align: right;">
polychlorinated biphenyls - Deprecated- Report as single PCBs
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB194
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,3’,4,4’,5,5’-octachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB105
</td>
<td style="text-align: right;">
2,3,3’,4,4’-pentachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB110
</td>
<td style="background-color: #8d909e; text-align: right;">
2,3,3’,4’,6-pentachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB126
</td>
<td style="text-align: right;">
3,3’,4,4’,5-pentachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB128
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,3’,4,4’-hexachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB149
</td>
<td style="text-align: right;">
2,2’,3,4’,5’,6-hexachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB151
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,5,5’,6-hexachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB156
</td>
<td style="text-align: right;">
2,3,3’,4,4’,5-hexachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB157
</td>
<td style="background-color: #8d909e; text-align: right;">
2,3,4,3’,4’,5’-hexachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB170
</td>
<td style="text-align: right;">
2,2’,3,3’,4,4’,5-heptachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB44
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,5’-tetrachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB49
</td>
<td style="text-align: right;">
2,2’,4,5’-tetrachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB99
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,4,4’,5-pentachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB77
</td>
<td style="text-align: right;">
3,3’,4,4’-tetrachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB169
</td>
<td style="background-color: #8d909e; text-align: right;">
3,3’,4,4’,5,5’-hexachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB31
</td>
<td style="text-align: right;">
2,4’,5-trichlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB81
</td>
<td style="background-color: #8d909e; text-align: right;">
3,4,4’,5-tetrachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
SCB
</td>
<td style="text-align: right;">
sum of CBs.- Specify in method data
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB189
</td>
<td style="background-color: #8d909e; text-align: right;">
2,3,3’,4,4’,5,5’-heptachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB114
</td>
<td style="text-align: right;">
2,3,4,4’,5-pentachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB123
</td>
<td style="background-color: #8d909e; text-align: right;">
1,1’-Biphenyl, 2,3’,4,4’,5’-pentachloro-
</td>
</tr>
<tr>
<td style="text-align: left;">
CB167
</td>
<td style="text-align: right;">
2’,3,4,4’,5,5’-hexachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB187
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,4’,5,5’,6-heptachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB66
</td>
<td style="text-align: right;">
2,3’,4,4’-tetrachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB60
</td>
<td style="background-color: #8d909e; text-align: right;">
1,1’-Biphenyl, 2,3,4,4’-tetrachloro-
</td>
</tr>
<tr>
<td style="text-align: left;">
CB141
</td>
<td style="text-align: right;">
2,2’,3,4,5,5’-hexachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB74
</td>
<td style="background-color: #8d909e; text-align: right;">
2,4,4’,5-tetrachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB206
</td>
<td style="text-align: right;">
2,2’,3,3’,4,4’,5,5’,6-nonachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB33
</td>
<td style="background-color: #8d909e; text-align: right;">
2’,3,4-trichlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB18
</td>
<td style="text-align: right;">
2,2’,5-trichlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB183
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,4,4’,5’,6-heptachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB47
</td>
<td style="text-align: right;">
2,2’,4,4’-tetrachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB209
</td>
<td style="background-color: #8d909e; text-align: right;">
2,2’,3,3’,4,4’,5,5’,6,6’-decachlorobiphenyl
</td>
</tr>
<tr>
<td style="text-align: left;">
CB51
</td>
<td style="text-align: right;">
2,2’,4,6’-Tetrachlorobiphenyl
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CB122
</td>
<td style="background-color: #8d909e; text-align: right;">
1,1’-Biphenyl, 2,3,3’,4’,5’-pentachloro-
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">
CB138+163
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
2,2’,3,4,4’,5’-hexachlorobiphenyl
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<strong>PCBs in Sediment</strong> <!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsSediment_PCBs/ContaminantsSediment_PCBs.csv -->
<table class="table" style>
<caption>
<span id="tab:unnamed-chunk-3">Table 1.2: </span>Source: <a href="http://dome.ices.dk/views/ContaminantsSediment.aspx">ICES Database</a> <br> Downloaded 13 February 2020 by Ellie Campbell
</caption>
<thead>
<tr>
<th style="text-align:left;">
Option
</th>
<th style="text-align:left;">
Specification
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
All8
</td>
</tr>
<tr>
<td style="text-align:left;">
Purpose of monitoring
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Monitoring Program
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Parameter Group
</td>
<td style="text-align:left;">
Chlorobiphenyls
</td>
</tr>
<tr>
<td style="text-align:left;">
Reporting Laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Analytical laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Geographical Areas
</td>
<td style="text-align:left;">
(ICES) All ICES Areas
</td>
</tr>
</tbody>
</table>
<p><br/></p>
</div>
<div id="pfos-data" class="section level4 unnumbered">
<h4>2.1.2 PFOS Data</h4>
<strong>PFOS in Biota</strong><br />
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_PFOS/ContaminantsBiota_PFOS.csv --> <!-- w/ one year more of data...BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_PFOS/ContaminantsBiota_20Feb07_PFOS.csv -->
<table class="table" style>
<caption>
<span id="tab:unnamed-chunk-4">Table 1.3: </span>Source: <a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES Database</a> <br> Downloaded 22 April 2019 by Ellie Campbell
</caption>
<thead>
<tr>
<th style="text-align:left;">
Option
</th>
<th style="text-align:left;">
Specification
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
2005-2017 (2005 earliest allowed)
</td>
</tr>
<tr>
<td style="text-align:left;">
Purpose of monitoring
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Monitoring Program
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Parameter Group
</td>
<td style="text-align:left;">
Organofluorines
</td>
</tr>
<tr>
<td style="text-align:left;">
Reporting Laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Analytical laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Geographical Areas
</td>
<td style="text-align:left;">
(HELCOM) ALL HELCOM sub-basins
</td>
</tr>
</tbody>
</table>
<p><br/></p>
</div>
<div id="dioxin-data" class="section level4 unnumbered">
<h4>2.1.3 Dioxin Data</h4>
<strong>Dioxins in Biota</strong><br />
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_Dioxins/ContaminantsBiota_Dioxins.csv --> <!-- w/ one year more...BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_Dioxins/ContaminantsBiota_20Feb07_Dioxins.csv -->
<table class="table" style>
<caption>
<span id="tab:unnamed-chunk-5">Table 1.4: </span>Source: <a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES Database</a> <br> Downloaded 22 April 2019 by Ellie Campbell
</caption>
<thead>
<tr>
<th style="text-align:left;">
Option
</th>
<th style="text-align:left;">
Specification
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
1998-2017 (1998 earliest allowed)
</td>
</tr>
<tr>
<td style="text-align:left;">
Purpose of monitoring
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Monitoring Program
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Parameter Group
</td>
<td style="text-align:left;">
Dioxins
</td>
</tr>
<tr>
<td style="text-align:left;">
Reporting Laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Analytical laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Geographical Areas
</td>
<td style="text-align:left;">
(HELCOM) ALL HELCOM sub-basins
</td>
</tr>
</tbody>
</table>
<strong>Dioxin Congeners</strong> <!-- reference codes found here: https://vocab.ices.dk/?CodeID=26986 -->
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Data Code
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">
CDD1N
</td>
<td style="text-align: right;">
1 2 3 7 8-pentachlorodibenzo-p-dioxin
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDD4X
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 4 7 8-hexachlorodibenzo-p-dioxin
</td>
</tr>
<tr>
<td style="text-align: left;">
CDD6P
</td>
<td style="text-align: right;">
1 2 3 4 6 7 8-heptachlorodibenzo-p-dioxin
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDD6X
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 6 7 8-hexachlorodibenzo-p-dioxin
</td>
</tr>
<tr>
<td style="text-align: left;">
CDD9X
</td>
<td style="text-align: right;">
1 2 3 7 8 9-hexachlorodibenzo-p-dioxin
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDDO
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 4 6 7 8 9-octachlorodibenzo-p-dioxin
</td>
</tr>
<tr>
<td style="text-align: left;">
CDF2N
</td>
<td style="text-align: right;">
2 3 4 7 8-pentachlorodibenzofuran
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDF2T
</td>
<td style="background-color: #8d909e; text-align: right;">
2 3 7 8-tetrachloro-dibenzofuran
</td>
</tr>
<tr>
<td style="text-align: left;">
CDF4X
</td>
<td style="text-align: right;">
2 3 4 6 7 8-hexachlorodibenzofuran
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDF6P
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 4 6 7 8-heptachlorodibenzofuran
</td>
</tr>
<tr>
<td style="text-align: left;">
CDF6X
</td>
<td style="text-align: right;">
1 2 3 6 7 8-hexachlorodibenzofuran
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDF9P
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 4 7 8 9-heptachlorodibenzofuran
</td>
</tr>
<tr>
<td style="text-align: left;">
CDF9X
</td>
<td style="text-align: right;">
1 2 3 7 8 9-hexachlorodibenzofuran
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; text-align: left;">
CDFDN
</td>
<td style="background-color: #8d909e; text-align: right;">
1 2 3 7 8/1 2 3 4 8-pentachloro-dibenzofuran
</td>
</tr>
<tr>
<td style="text-align: left;">
CDFO
</td>
<td style="text-align: right;">
octachloro-dibenzofuran (group)
</td>
</tr>
<tr style="background-color: #8d909e;">
<td style="background-color: #8d909e; border-bottom: 2px solid grey; text-align: left;">
TCDD
</td>
<td style="background-color: #8d909e; border-bottom: 2px solid grey; text-align: right;">
2 3 7 8-tetrachlorodibenzo-p-dioxin
</td>
</tr>
</tbody>
</table>
<p><br></p>
<strong>Dioxins in Sediment</strong><br />
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsSediment_Dioxins/ContaminantsSediment_Dioxins.csv -->
<table class="table" style>
<caption>
<span id="tab:unnamed-chunk-7">Table 1.5: </span>Source: <a href="http://dome.ices.dk/views/ContaminantsSediment.aspx">ICES Database</a> <br> Downloaded 13 February 2020 by Ellie Campbell
</caption>
<thead>
<tr>
<th style="text-align:left;">
Option
</th>
<th style="text-align:left;">
Specification
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Purpose of monitoring
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Monitoring Program
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Parameter Group
</td>
<td style="text-align:left;">
Dioxins
</td>
</tr>
<tr>
<td style="text-align:left;">
Reporting Laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Analytical laboratory
</td>
<td style="text-align:left;">
All
</td>
</tr>
<tr>
<td style="text-align:left;">
Geographical Areas
</td>
<td style="text-align:left;">
(ICES) All ICES Areas
</td>
</tr>
</tbody>
</table>
</div>
<div id="concerning-substances-datasets" class="section level4 unnumbered">
<h4>2.1.4 Concerning Substances Datasets</h4>
<!-- datasets save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsBiota_ConcerningSubstances -->
<!-- datasets save location BHI_share/BHI 2.0/Goals/CW/CON/ContaminantsSediment_ConcerningSubstances -->
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/CON/concerning_substances_lookup.csv -->
<p>A list of concerning substances was obtained from <a href="https://echa.europa.eu/candidate-list-table?p_p_id=disslists_WAR_disslistsportlet&amp;p_p_lifecycle=1&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_pos=2&amp;p_p_col_count=3&amp;_disslists_WAR_disslistsportlet_javax.portlet.action=searchDissLists">European Chemical Agency Candidate List of substances of very high concern for Authorisation</a> (published in accordance with Article 59(10) of the REACH Regulation). These substances were compared with those in the <a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES database</a>. Datasets for substances with ICES records were downloaded and saved in a similar manner as the PCBs, PFOS, and Organofluorines datasets.</p>
<hr />
<p><br></p>
</div>
</div>
<div id="centralization-normalization" class="section level3 unnumbered">
<h3>2.2 Centralization &amp; Normalization</h3>
<!-- note: remainder of this document incorporates from BHI1.0, along with preliminary contaminants_prep.Rmd sections: -->
<!-- raw_pcb_data_prep.R, raw_dioxin_data_prep.R, and raw_pfos_data_prep.R -->
<!-- station_attribute_prep.R, congener_description.R -->
<p>This preliminary data wrangling includes steps to harmonize and check the 5 datasets used in the Contaminants subgoal:</p>
<ul>
<li>Check number of years with samples by Country and Species, for Contaminants in Biota datasets</li>
<li>Rename columns and some variables within columns to improve clarity</li>
<li>Standardize by converting units and also between methods of measurement (e.g. wet vs. dry weight or muscle vs liver matrix analyzed)</li>
</ul>
<p>More details about the standardization and convertions in section 2.2.2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## root location of the raw data
dir_rawdata &lt;-<span class="st"> </span><span class="kw">file.path</span>(dir_B, <span class="st">&quot;Goals&quot;</span>, <span class="st">&quot;CW&quot;</span>, <span class="st">&quot;CON&quot;</span>)

<span class="kw">lapply</span>(
  <span class="kw">list</span>(
    <span class="kw">c</span>(<span class="st">&quot;ContaminantsBiota_20Feb07_PCBs&quot;</span>, <span class="st">&quot;pcb_rawdata_bio&quot;</span>),
    <span class="kw">c</span>(<span class="st">&quot;ContaminantsSediment_PCBs&quot;</span>, <span class="st">&quot;pcb_rawdata_sed&quot;</span>),
    <span class="kw">c</span>(<span class="st">&quot;ContaminantsBiota_20Feb07_PFOS&quot;</span>, <span class="st">&quot;pfos_rawdata_bio&quot;</span>),
    <span class="kw">c</span>(<span class="st">&quot;ContaminantsBiota_20Feb07_Dioxins&quot;</span>, <span class="st">&quot;dioxin_rawdata_bio&quot;</span>),
    <span class="kw">c</span>(<span class="st">&quot;ContaminantsSediment_Dioxins&quot;</span>, <span class="st">&quot;dioxin_rawdata_sed&quot;</span>)
  ),
  <span class="cf">function</span>(x){
    <span class="kw">read_csv</span>(
      <span class="kw">file.path</span>(dir_rawdata, x[<span class="dv">1</span>], <span class="kw">paste</span>(x[<span class="dv">1</span>], <span class="st">&quot;csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)),
      ## where not read in correctly, column types must be specified ...
      <span class="dt">col_types =</span> <span class="kw">cols</span>(
        <span class="dt">.default =</span> <span class="kw">col_character</span>(),
        <span class="dt">MYEAR =</span> <span class="kw">col_number</span>(), 
        <span class="dt">Latitude =</span> <span class="kw">col_number</span>(), 
        <span class="dt">Longitude =</span> <span class="kw">col_number</span>(), 
        <span class="dt">NOINP =</span> <span class="kw">col_number</span>(),
        <span class="dt">Value =</span> <span class="kw">col_number</span>(), 
        <span class="dt">DETLI =</span> <span class="kw">col_number</span>(), 
        <span class="dt">LMQNT =</span> <span class="kw">col_number</span>(), 
        <span class="dt">UNCRT =</span> <span class="kw">col_number</span>(),
        <span class="dt">tblAnalysisID =</span> <span class="kw">col_number</span>(), 
        <span class="dt">tblParamID =</span> <span class="kw">col_number</span>(), 
        <span class="dt">tblBioID =</span> <span class="kw">col_number</span>(), 
        <span class="dt">tblSampleID =</span> <span class="kw">col_number</span>()
      )
    ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">assign</span>(<span class="dt">x =</span> x[<span class="dv">2</span>], <span class="dt">envir =</span> .GlobalEnv)
  }
)</code></pre></div>
<div id="check-number-of-years-with-samples-by-country-.tabset-.tabset-fade-.tabset-pills" class="section level5 unnumbered">
<h5>Check number of years with samples by Country {.tabset .tabset-fade .tabset-pills}</h5>
<div id="pcbs" class="section level6 unnumbered">
<h6>PCBs</h6>
<div id="htmlwidget-6356e4aaf139e80c7f6b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6356e4aaf139e80c7f6b">{"x":{"filter":"none","data":[["Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Poland","Poland","Poland","Poland","Poland","Finland","Finland","Finland","Germany","Germany","Germany","Germany","Germany","Germany","Germany","Germany","Germany","Germany","Denmark","Denmark","Denmark","Denmark","Denmark","Denmark","Estonia","Estonia","Estonia","Latvia","Latvia","Latvia","Lithuania","Lithuania","Lithuania","Lithuania","Lithuania"],["Cancer pagurus","Clupea harengus","Gadus morhua","Limanda limanda","Mytilus edulis","Perca fluviatilis","Platichthys flesus","Uria aalge","Zoarces viviparus","Clupea harengus","Gadus morhua","Mytilus edulis","Perca fluviatilis","Platichthys flesus","Clupea harengus","Perca fluviatilis","Saduria entomon","Abramis brama","Clupea harengus","Dreissena polymorpha","Gadus morhua","Larus argentatus","Limanda limanda","Mytilus edulis","Perca fluviatilis","Platichthys flesus","Zoarces viviparus","Mya arenaria","Mytilus edulis","Neogobius melanostomus","Platichthys flesus","Pleuronectes platessa","Zoarces viviparus","Clupea harengus","Clupea harengus membras","Perca fluviatilis","Clupea harengus","Macoma balthica","Perca fluviatilis","Clupea harengus","Gadus morhua","Macoma balthica","Mytilus edulis","Platichthys flesus"],[1,27,27,5,26,20,1,18,20,27,4,19,8,7,20,5,1,1,12,2,8,10,8,15,18,1,6,4,19,1,20,1,8,8,5,10,1,1,1,2,2,1,1,2],[2006,2014,2014,1993,2014,2014,2007,2014,2014,2014,1992,2014,2014,2014,2011,2010,1992,2017,2015,2014,2015,2015,2015,2015,2015,1998,2011,2006,2014,2018,2014,2018,2014,2018,2014,2014,2002,2002,2002,2016,2016,2015,2015,2016]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>Species<\/th>\n      <th>NumYrs<\/th>\n      <th>LatestYr<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<hr />
<p><br></p>
</div>
<div id="pfos" class="section level6 unnumbered">
<h6>PFOS</h6>
<div id="htmlwidget-e982e9b48a2761c874f5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e982e9b48a2761c874f5">{"x":{"filter":"none","data":[["Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Finland","Finland","Denmark","Denmark","Denmark","Denmark","Poland","Poland","Poland","Lithuania","Lithuania","Lithuania","Lithuania","Lithuania","Estonia","Estonia","Germany","Germany","Germany"],["Clupea harengus","Gadus morhua","Mytilus edulis","Perca fluviatilis","Uria aalge","Zoarces viviparus","Clupea harengus","Perca fluviatilis","Neogobius melanostomus","Platichthys flesus","Pleuronectes platessa","Zoarces viviparus","Clupea harengus","Perca fluviatilis","Platichthys flesus","Clupea harengus","Gadus morhua","Macoma balthica","Mytilus edulis","Platichthys flesus","Clupea harengus","Perca fluviatilis","Abramis brama","Perca fluviatilis","Zoarces viviparus"],[11,2,1,2,10,2,4,5,1,7,1,7,5,5,5,2,2,1,1,2,1,2,1,1,1],[2017,2017,2007,2017,2017,2017,2018,2016,2018,2017,2018,2017,2018,2018,2018,2016,2016,2015,2015,2016,2018,2018,2017,2017,2017]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>Species<\/th>\n      <th>NumYrs<\/th>\n      <th>LatestYr<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<hr />
<p><br></p>
</div>
<div id="dioxins" class="section level6 unnumbered">
<h6>Dioxins</h6>
<div id="htmlwidget-27ae75fc6005f225a6b0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-27ae75fc6005f225a6b0">{"x":{"filter":"none","data":[["Sweden","Sweden","Sweden","Sweden","Sweden","Sweden","Denmark","Denmark","Denmark","Denmark","Denmark","Denmark","Finland","Finland","Lithuania","Lithuania","Lithuania","Lithuania","Lithuania","Estonia","Estonia","Germany","Germany","Germany"],["Cancer pagurus","Clupea harengus","Mytilus edulis","Perca fluviatilis","Platichthys flesus","Uria aalge","Mya arenaria","Mytilus edulis","Neogobius melanostomus","Platichthys flesus","Pleuronectes platessa","Zoarces viviparus","Clupea harengus","Perca fluviatilis","Clupea harengus","Gadus morhua","Macoma balthica","Mytilus edulis","Platichthys flesus","Clupea harengus","Perca fluviatilis","Abramis brama","Perca fluviatilis","Zoarces viviparus"],[1,12,2,8,1,10,1,12,1,7,1,8,3,5,2,2,1,1,2,1,1,1,1,1],[2006,2017,2007,2017,2007,2017,2005,2017,2018,2017,2018,2017,2018,2016,2016,2016,2015,2015,2016,2018,2018,2017,2017,2017]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>Species<\/th>\n      <th>NumYrs<\/th>\n      <th>LatestYr<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<hr />
<p><br></p>
</div>
</div>
<div id="rename-fieldsvariables" class="section level4 unnumbered">
<h4>2.2.1 Rename Fields/Variables</h4>
<p>Renaming columns and some variables within columns for clarity. See references: <a href="http://dome.ices.dk/Download/Contaminants%20and%20effects%20of%20contaminants%20in%20biota.pdf">Contaminants in Biota</a> and <a href="http://dome.ices.dk/Download/Contaminants%20and%20effects%20of%20contaminants%20in%20sediment.pdf">Contaminants in Sediment</a>. For more information about the ICES reporting format for environmental data see <a href="http://ices.dk/marine-data/Documents/ENV/ERF3.2.doc">this document</a>, also referenced in <a href="https://portal.helcom.fi/meetings/HELCOM%20BalticBOOST%20HZ%20WS%201-2016-323/MeetingDocuments/1-9%20Comparison%20of%20COMBINE%20data%20fields%20to%20EIONET%20data%20fields.pdf">this document from HELCOM BalticBOOST workshop</a> on the HOLAS II hazardous substance assessment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rename_vars &lt;-<span class="st"> </span><span class="cf">function</span>(dataset){
  
  df_vars_renamed &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>
<span class="st">    </span>## create date, month, year, day columns
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(DATE, <span class="st">&quot;%d/%m/%Y&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(
      <span class="dt">day =</span> lubridate<span class="op">::</span><span class="kw">day</span>(date),
      <span class="dt">month =</span> lubridate<span class="op">::</span><span class="kw">month</span>(date), 
      <span class="dt">year =</span> lubridate<span class="op">::</span><span class="kw">year</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>
<span class="st">    </span>## change column names
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(
      <span class="dt">country =</span> Country, <span class="dt">report_institute =</span> RLABO,
      <span class="dt">station =</span> STATN, 
      <span class="dt">monit_year =</span> MYEAR, <span class="dt">date_ices =</span> DATE,
      
      <span class="dt">latitude =</span> Latitude, <span class="dt">longitude =</span> Longitude,
      
      <span class="dt">param_group =</span> PARGROUP, <span class="dt">variable =</span> PARAM, 
      <span class="dt">value =</span> Value, <span class="dt">unit =</span> MUNIT,
      
      <span class="dt">species =</span> Species, <span class="dt">sex_specimen =</span> SEXCO, <span class="dt">num_indiv_subsample =</span> NOINP,
      <span class="dt">test_organism =</span> <span class="st">`</span><span class="dt">Test Organism</span><span class="st">`</span>,
      <span class="dt">matrix_analyzed =</span> MATRX, <span class="dt">not_used_in_datatype =</span> NODIS,
      
      <span class="dt">monit_program =</span> MPROG, <span class="dt">monit_purpose =</span> PURPM,
      
      <span class="dt">basis_determination =</span> BASIS, <span class="dt">qflag =</span> QFLAG,
      <span class="dt">vflag =</span> VFLAG, <span class="dt">detect_lim =</span> DETLI,
      <span class="dt">quant_lim =</span> LMQNT, <span class="dt">uncert_val =</span> UNCRT, <span class="dt">method_uncert =</span> METCU,
      
      <span class="dt">analyt_lab =</span> ALABO, <span class="dt">ref_source =</span> REFSK, 
      <span class="dt">method_storage =</span> METST, <span class="dt">method_pretreat =</span> METPT, 
      <span class="dt">method_pur_sep =</span> METPS, <span class="dt">method_chem_fix =</span> METFP,
      <span class="dt">method_chem_extract =</span> METCX, <span class="dt">method_analysis =</span> METOA, 
      <span class="dt">formula_calc =</span> FORML,
      
      <span class="dt">sub_samp_id =</span> SUBNO, <span class="dt">bulk_id =</span> BULKID,
      <span class="dt">sampler_type =</span> SMTYP, <span class="dt">factor_compli_interp =</span> FINFL,
      
      <span class="dt">analyt_method_ref =</span> tblAnalysisID, 
      <span class="dt">measurement_ref =</span> tblParamID,
      <span class="dt">samp_ref =</span> tblSampleID
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>
<span class="st">    </span>## improve clarity of &#39;basis_determination&#39; and &#39;matrix_analyzed&#39; column content
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">basis_determination =</span> <span class="kw">case_when</span>(
      basis_determination <span class="op">==</span><span class="st"> &quot;L&quot;</span> <span class="op">~</span><span class="st"> &quot;lipid weight&quot;</span>,
      basis_determination <span class="op">==</span><span class="st"> &quot;W&quot;</span> <span class="op">~</span><span class="st"> &quot;wet weight&quot;</span>,
      basis_determination <span class="op">==</span><span class="st"> &quot;D&quot;</span> <span class="op">~</span><span class="st"> &quot;dry weight&quot;</span>
    )) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">matrix_analyzed =</span> <span class="kw">case_when</span>(
      matrix_analyzed <span class="op">==</span><span class="st"> &quot;LI&quot;</span> <span class="op">~</span><span class="st"> &quot;liver&quot;</span>,
      matrix_analyzed <span class="op">==</span><span class="st"> &quot;MU&quot;</span> <span class="op">~</span><span class="st"> &quot;muscle&quot;</span>,
      matrix_analyzed <span class="op">==</span><span class="st"> &quot;WO&quot;</span> <span class="op">~</span><span class="st"> &quot;wholeorganism&quot;</span>
    ))
  
  <span class="kw">return</span>(df_vars_renamed)
}

## same names and structures so can apply function to all datasets
<span class="kw">lapply</span>(
  <span class="kw">list</span>(<span class="st">&quot;pcb_rawdata_bio&quot;</span>, <span class="st">&quot;pfos_rawdata_bio&quot;</span>, <span class="st">&quot;dioxin_rawdata_bio&quot;</span>),
  <span class="cf">function</span>(x){
    renameddf &lt;-<span class="st"> </span><span class="kw">rename_vars</span>(<span class="kw">get</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">rename</span>(<span class="dt">sub_samp_ref =</span> tblBioID)
    <span class="kw">assign</span>(<span class="kw">str_remove</span>(x, <span class="st">&quot;_rawdata&quot;</span>), renameddf, <span class="dt">envir =</span> .GlobalEnv)
  }
)
<span class="kw">lapply</span>(
  <span class="kw">list</span>(<span class="st">&quot;pcb_rawdata_sed&quot;</span>, <span class="st">&quot;dioxin_rawdata_sed&quot;</span>),
  <span class="cf">function</span>(x){
    renameddf &lt;-<span class="st"> </span><span class="kw">rename_vars</span>(<span class="kw">get</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">rename</span>(<span class="dt">press_depth =</span> DEPHU, <span class="dt">depth_low =</span> DEPHL) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">press_depth =</span> <span class="kw">as.numeric</span>(press_depth), <span class="dt">depth_low =</span> <span class="kw">as.numeric</span>(depth_low))
    <span class="kw">assign</span>(<span class="kw">str_remove</span>(x, <span class="st">&quot;_rawdata&quot;</span>), renameddf, <span class="dt">envir =</span> .GlobalEnv)
  }
)</code></pre></div>
<hr />
</div>
<div id="standardize-units" class="section level4 unnumbered">
<h4>2.2.2 Standardize Units</h4>
<p>The main objective of the code below is to clean the contaminants datases set so they contain only values based on wet weight for biota or dry weight for sediment-matrix measurements, in standardized units of ug/kg. This includes the following pre-processing steps:</p>
<ul>
<li>Remove flagged and deprecated data entries<br />
</li>
<li>Separate <code>B-BIO</code> data from the other param group data (<code>OC-CB</code>, <code>OC-DX</code>, or <code>O-FL</code> for PCB, Dioxin, PFOS resp.) for use in lipid basis to wet weight conversion for biota or for conversion to dry weight for sediments; also for calculation of muscle equivalent in PFOS data</li>
<li>Take averages where there are duplicate data samples, based on the <code>sub_samp_ref</code> value groupings for biota or <code>samp_ref</code> value groupings for sediment-matrix measurements<br />
</li>
<li>If wrangling PFOS dataset, calculate the muscle equivalent of values where matrix analyzed was liver, using <a href="https://www.diva-portal.org/smash/get/diva2:767385/FULLTEXT01.pdf">Faxneld et al 2014, table 8</a></li>
<li>Convert all congener concentration data to ug/kg, and to wet weight for biota or dry weight for sediment</li>
<li>If data were presented in lipid weight, they were converted to wet weight by: <span class="math inline">\((\mbox{EXLIP%}/100)*(\mbox{CB conc. lipid weight})\)</span></li>
</ul>
<p>The datasets each contain two main categories (param_groups) one of which is BBIO. BBIO consists of variables with information about the sample like dry/lipid/wet weight percentage, age, weight and length. The second category contains the congeners concentration information. In stages, these are each manipulated and later rejoined by the sample (<code>samp_ref</code> or <code>sub_samp_ref</code>) ID numbers.</p>
<p><br></p>
<p><strong>Check Sediment data Coverage before Filtering and Standardizing Units</strong></p>
<p>Setting the cutoff to 0.05m (concentration measurements from sediment samples taked from within 5cm of the surface) means we retain coverage in the Gulf of Finland for PCBs indicator, and many more measurements in Germany around Kiel. Setting the depth cutoff to any smaller value would result in poor coverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## basemap with baltic countries borders and BHI regions with ID numbers
bhi_rgns_simple &lt;-<span class="st"> </span>rmapshaper<span class="op">::</span><span class="kw">ms_simplify</span>(
  <span class="dt">input =</span>  sf<span class="op">::</span><span class="kw">st_read</span>(
    <span class="dt">dsn =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>, <span class="st">&quot;BHI_shapefile_corrected&quot;</span>), 
    <span class="dt">layer =</span> <span class="st">&quot;BHI_shapefile_corrected&quot;</span>,
    <span class="dt">quiet =</span> <span class="ot">TRUE</span>
  )) <span class="op">%&gt;%</span><span class="st"> </span>sf<span class="op">::</span><span class="kw">st_as_sf</span>()

basemap &lt;-<span class="st"> </span>ggplot2<span class="op">::</span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(
    <span class="dt">data =</span> rnaturalearth<span class="op">::</span><span class="kw">ne_countries</span>(<span class="dt">scale =</span> <span class="st">&quot;medium&quot;</span>, <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>sf<span class="op">::</span><span class="kw">st_crop</span>(<span class="dt">xmin =</span> <span class="dv">0</span>, <span class="dt">xmax =</span> <span class="dv">40</span>, <span class="dt">ymin =</span> <span class="dv">53</span>, <span class="dt">ymax =</span> <span class="dv">67</span>),
    <span class="dt">fill =</span> <span class="st">&quot;ivory&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;lightsteelblue&quot;</span>,
    <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> bhi_rgns_simple, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">size =</span> <span class="fl">0.15</span>, <span class="dt">color =</span> <span class="st">&quot;lightsteelblue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limit =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">32</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limit =</span> <span class="kw">c</span>(<span class="fl">53.5</span>, <span class="dv">66</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#F8FBFC&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;#E2EEF3&quot;</span>))</code></pre></div>
<p><br></p>
<p><img src="bhi-prep_files/figure-html/spatial%20coverage%20for%20sediment%20measurement%20depths-1.png" width="1296" /></p>
<p><br></p>
<!-- the following code chunks are modified from raw_data_prep.r scripts in bhi-1.0-archive/baltic2015/prep/CW/contaminants -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">standardize_con_data &lt;-<span class="st"> </span><span class="cf">function</span>(data_renamed, <span class="dt">matrix_biota =</span> <span class="ot">TRUE</span>, contam_param, <span class="dt">rm_vars =</span> <span class="ot">NULL</span>){
  
  contam_param &lt;-<span class="st"> </span><span class="kw">substr</span>(contam_param, <span class="kw">str_length</span>(contam_param)<span class="op">-</span><span class="dv">1</span>, <span class="kw">str_length</span>(contam_param))
  
  ## what are the specific parameters?
  ## unique parameter groups and associated variables:
  chk_params &lt;-<span class="st"> </span>data_renamed <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(param_group, variable) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">arrange</span>(param_group, variable)
 
  ## filter and/or remove unneeded variables from data ----
  <span class="kw">message</span>(<span class="st">&quot;STEP 1: filter and/or unselect unneeded variables and congeners from dataset</span><span class="ch">\n</span><span class="st">&quot;</span>)
  df &lt;-<span class="st"> </span>data_renamed <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>## remove &#39;suspect&#39; and other non-&#39;acceptable&#39;: https://vocab.ices.dk/?ref=58
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>vflag <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>## remove certain variables-- summarized data or depreciated codes
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>variable <span class="op">%in%</span><span class="st"> </span>rm_vars)
  
  <span class="cf">if</span>(contam_param <span class="op">!=</span><span class="st"> &quot;FL&quot;</span>){
    ## remove samples for liver tissue, keep muscle, and whole organism for length x weight
    df &lt;-<span class="st"> </span><span class="kw">filter</span>(df, matrix_analyzed <span class="op">!=</span><span class="st"> &quot;liver&quot;</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(matrix_analyzed))
  }
  ## for PFOS (contaminant pargroup &#39;O-FL&#39;), keep liver measurements-- 
  ## all compounds except parameter &#39;PFOS&#39; measured only in the liver
  ## DRYWT% and EXLIP% have been measured for both muscle and liver
  
  
  ## sediment versus biota datasets, different sample/id variables
  sampvars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sub_samp_id&quot;</span>, <span class="st">&quot;samp_ref&quot;</span>, <span class="st">&quot;sub_samp_ref&quot;</span>)
  <span class="cf">if</span>(<span class="op">!</span>matrix_biota){
    sampvars &lt;-<span class="st"> </span><span class="kw">setdiff</span>(sampvars, <span class="st">&quot;sub_samp_ref&quot;</span>)
  }
  ## check alignment of all measurements with sub_samp_ref for biota, samp_ref for sediment
  ## (most unique besides measurement_ref)
  ## there are more unique measurement_ref but these are for different vars w/in sub_samp_id
  chk_ids &lt;-<span class="st"> </span><span class="kw">c</span>()
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">c</span>(sampvars, <span class="st">&quot;measurement_ref&quot;</span>)){
    chk_ids &lt;-<span class="st"> </span><span class="kw">c</span>(chk_ids, <span class="kw">sprintf</span>(<span class="st">&quot;%s: %s&quot;</span>, i, <span class="kw">length</span>(<span class="kw">unique</span>(df[[i]]))))
  }
  <span class="cf">if</span>(<span class="kw">nrow</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(sampvars[<span class="kw">length</span>(sampvars)]))) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">warning</span>(<span class="kw">sprintf</span>(<span class="st">&quot;there are observations without %s in the dataset&quot;</span>, sampvars[<span class="kw">length</span>(sampvars)]))
  }
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">&quot;NOTE will align by %s when grouping to identify duplicates</span><span class="ch">\n</span><span class="st">&quot;</span>, sampvars[<span class="kw">length</span>(sampvars)]))
  
  
  ## BBIO DATA
  
  ## separate out bbio data for lipid to wet-weight conversion ----
  ## B-BIO variable code: http://vocab.ices.dk/?CodeID=51634
  ## b-bio data -- length, weight, fat and lipid content
  ## lipid content, etc. needed to convert lipid basis samples into the wet weight are in the B-BIO column
  <span class="kw">message</span>(<span class="st">&quot;STEP 2: separate out bbio data and wrangle for use in lipid to wet-weight conversion...</span><span class="ch">\n</span><span class="st">&quot;</span>)
  df_bbio &lt;-<span class="st"> </span>df  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(param_group <span class="op">==</span><span class="st"> &quot;B-BIO&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(
      station, latitude, longitude, date, year, 
      species, matrix_analyzed, basis_determination, qflag,
      variable, unit, value,
      <span class="op">!!!</span><span class="kw">syms</span>(sampvars)
    )
  
  ## if there are cm, convert to mm
  df_bbio &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">left_join</span>(
      <span class="kw">read_csv</span>(
        here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;supplement&quot;</span>, <span class="st">&quot;lookup_tabs&quot;</span>, <span class="st">&quot;unit_conversion.csv&quot;</span>),
        <span class="dt">col_types =</span> <span class="kw">cols</span>()
      ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(ConvertUnit <span class="op">==</span><span class="st"> &quot;mm&quot;</span>),
      <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;unit&quot;</span> =<span class="st"> &quot;OriginalUnit&quot;</span>)
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(
      <span class="dt">value =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(ConvertUnit), value, value<span class="op">*</span>ConvertFactor),
      <span class="dt">unit =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(ConvertUnit), unit, <span class="st">&quot;mm&quot;</span>)
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>ConvertUnit, <span class="op">-</span>ConvertFactor)
  
  ## confirm that units of bbio, are one-to-one
  chk_bbio_units &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(variable, unit) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">distinct</span>()
  
  ## if dealing with sediment, need to keep units for now...
  <span class="cf">if</span>(matrix_biota){df_bbio &lt;-<span class="st"> </span><span class="kw">select</span>(df_bbio, <span class="op">-</span>unit)}

  chk_num_bbio_dup &lt;-<span class="st"> </span><span class="kw">nrow</span>(df_bbio) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(df_bbio <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>value)))
  
  ## BBIO DUPLICATES
  ## identify, explore, handle bbio duplicates ----
  ## group to identify duplicates; for a given sub_samp_ref only some variables may have duplicates
  grpvars &lt;-<span class="st"> </span><span class="kw">c</span>(
    <span class="st">&quot;station&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;species&quot;</span>, <span class="st">&quot;basis_determination&quot;</span>, <span class="st">&quot;matrix_analyzed&quot;</span>, <span class="st">&quot;qflag&quot;</span>, 
    sampvars, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;variable&quot;</span>, <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>
  )
  chk &lt;-<span class="st"> </span><span class="kw">c</span>()
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>){
    bbio_duplicates &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">c</span>(grpvars[i], grpvars[<span class="dv">7</span><span class="op">:</span><span class="kw">length</span>(grpvars)]))) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>()
    chk &lt;-<span class="st"> </span><span class="kw">c</span>(chk, <span class="kw">nrow</span>(<span class="kw">filter</span>(bbio_duplicates, n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)))
  }
  <span class="cf">if</span>(<span class="kw">var</span>(chk) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">message</span>(<span class="kw">sprintf</span>(
      <span class="st">&quot;NOTE bbio duplicates dataframe dims vary with grpvars: %s&quot;</span>,
      <span class="kw">paste</span>(grpvars[<span class="kw">which</span>(chk <span class="op">!=</span><span class="st"> </span>chk[<span class="kw">which.max</span>(<span class="kw">tabulate</span>(<span class="kw">match</span>(chk, chk)))])], <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)
    ))
  }
  
  ## join duplicate table by grouped vars to locate within full bbio dataset
  bbio_duplicates &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(grpvars)) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>()
  df_bbio &lt;-<span class="st"> </span><span class="kw">left_join</span>(df_bbio, bbio_duplicates, <span class="dt">by =</span> grpvars)
  
  ## take averages for variable/sample duplicates
  df_bbio &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(
    ## averages of duplicates
    df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(grpvars)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarize</span>(<span class="dt">value =</span> <span class="kw">mean</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>(),
    ## rows of bbio data with no duplicates
    df_bbio <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>n)
  )
  
  ## check for unique variables and matrix_analyzed, per species
  chk_bbio_vars &lt;-<span class="st"> </span><span class="ot">NULL</span>
  <span class="cf">if</span>(matrix_biota){
    chk_bbio_vars &lt;-<span class="st"> </span><span class="kw">do.call</span>(
      rbind, 
      <span class="kw">lapply</span>(
        <span class="kw">as.list</span>(<span class="kw">unique</span>(df_bbio<span class="op">$</span>species)), 
        <span class="cf">function</span>(x){
          <span class="kw">cbind</span>(
            df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">filter</span>(species <span class="op">==</span><span class="st"> </span>x) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(matrix_analyzed, basis_determination, variable) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">arrange</span>(variable, matrix_analyzed, basis_determination),
            <span class="dt">species =</span> x
          )
        }
      )
    )
  }

  
  ## WIDE BBIO DATA
  ## bbio data wide format ----
  
  ## remove basis_determ. as some bio vars are recorded for whole organism, others for liver or muscle,
  ## no concentration variables measured for whole organism matrix, so don&#39;t need for joining...
  ## no problem pivoting wider also indicates uniquely identified by remaining grouping variables
  <span class="co"># unique(filter(df, param_group != &quot;B-BIO&quot;)$matrix_analyzed)</span>
  
  <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;FL&quot;</span>){
    ## for PFOS we have liver and muscle measurements
    ## need to deal with matrix_analyzed to get &#39;muscle equivalent&#39; from conc. measurements in liver
    df_bbio_wide &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">variable =</span> <span class="kw">paste</span>(matrix_analyzed, variable, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>matrix_analyzed, <span class="op">-</span>basis_determination)
  } <span class="cf">else</span> {
    df_bbio_wide &lt;-<span class="st"> </span>df_bbio <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>basis_determination)
  }
  df_bbio_wide &lt;-<span class="st"> </span>df_bbio_wide <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> value)
  

  ## which columns are needed to uniquely identify and later rejoin with congener conc. data
  ## i.e. at this stage, which subset of grpvars gives groupings such that all n are one?
  <span class="co"># for(i in grpvars){print(paste(i, length(unique(df_bbio_wide[[i]]))))}</span>
  chkgrpvars &lt;-<span class="st"> </span><span class="kw">intersect</span>(grpvars, <span class="kw">names</span>(df_bbio_wide))
  chk &lt;-<span class="st"> </span>chkgrpvars
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(chkgrpvars)){
    bbio_wide_duplicates &lt;-<span class="st"> </span>df_bbio_wide <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">setdiff</span>(chk, chkgrpvars[i]))) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)
    <span class="cf">if</span>(<span class="kw">nrow</span>(bbio_wide_duplicates) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
      chk &lt;-<span class="st"> </span><span class="kw">setdiff</span>(chk, chkgrpvars[i])
    }
  }
  <span class="kw">message</span>(<span class="kw">sprintf</span>(
    <span class="st">&quot;NOTE minimum group ID variables for later rejoining uniquely with congener data:</span><span class="ch">\n</span><span class="st">%s</span><span class="ch">\n</span><span class="st">&quot;</span>, 
    <span class="kw">paste</span>(chk, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)
  ))
  chk_bbio_wide_ids &lt;-<span class="st"> </span>chk
  ## sub_samp_id and samp_ref together are as unique as sub_samp_ref
  <span class="co"># nrow(select(df_bbio_wide, sub_samp_ref) %&gt;% distinct())</span>
  <span class="co"># nrow(select(df_bbio_wide, sub_samp_id, samp_ref) %&gt;% distinct())</span>
  
  
  ## CONGENER CONCENTRATIONS DATA
  ## check congener concentration data, units and duplicates ----
  
  <span class="cf">if</span>(<span class="op">!</span>matrix_biota){
    ## units of depth variables meters
    ## only keep sediment measurements in top 2cm, 
    ## or maximum 5cm if filtering to within 2cm of surface yeilds too few data pts...
    df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(depth_low <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) 
  }
  
  df_conc &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(param_group, <span class="dt">pattern =</span> contam_param)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(
      station, latitude, longitude, date, year,
      species, matrix_analyzed, basis_determination,
      variable, unit, value, detect_lim, quant_lim, qflag,
      <span class="op">!!!</span><span class="kw">syms</span>(sampvars)
    )
  
  ## convert congener concentration units all to ug/kg
  <span class="kw">message</span>(<span class="st">&quot;STEP 3: convert congener concentrations units to ug/kg&quot;</span>)
  df_conc &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(
      <span class="kw">read_csv</span>(
        here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;supplement&quot;</span>, <span class="st">&quot;lookup_tabs&quot;</span>, <span class="st">&quot;unit_conversion.csv&quot;</span>),
        <span class="dt">col_types =</span> <span class="kw">cols</span>()
      ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(ConvertUnit <span class="op">==</span><span class="st"> &quot;ug/kg&quot;</span>),
      <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;unit&quot;</span> =<span class="st"> &quot;OriginalUnit&quot;</span>)
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(
      <span class="dt">value =</span> value<span class="op">*</span>ConvertFactor, 
      <span class="dt">detect_lim =</span> detect_lim<span class="op">*</span>ConvertFactor,
      <span class="dt">unit =</span> <span class="st">&quot;ug/kg&quot;</span>
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>ConvertUnit, <span class="op">-</span>ConvertFactor)
  
  ## check whether variables vs units relationship is one-to-one
  chk_conc_units &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(variable, unit) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(variable)
  
  df_conc &lt;-<span class="st"> </span><span class="kw">select</span>(df_conc, <span class="op">-</span>unit)
  
  
  ## take averages for congener conc. variable x sample duplicates ----
  
  ## identify duplicates
  ## group to identify duplicates, 
  ## for a given sub_samp_ref only some vars/congeners may have duplicates
  <span class="kw">message</span>(<span class="st">&quot;STEP 4: averaging, where multiple congener concentrations observations per sub sample</span><span class="ch">\n</span><span class="st">&quot;</span>)
  chk_num_conc_dup &lt;-<span class="st"> </span><span class="kw">nrow</span>(df_conc) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(df_conc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>value, <span class="op">-</span>detect_lim, <span class="op">-</span>quant_lim)))

  conc_duplicates &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(grpvars)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>## no cases where duplicates with-and-without qflags, else would keep cases unflagged observations...
<span class="st">    </span><span class="co"># group_by(!!!syms(setdiff(grpvars, &quot;qflag&quot;))) %&gt;%</span>
<span class="st">    </span><span class="co"># mutate(allflagged = !any(is.na(qflag))) %&gt;%</span>
<span class="st">    </span><span class="co"># filter(n &gt; 1, !allflagged) %&gt;% ...</span>
<span class="st">    </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ungroup</span>()
  
  ## join duplicates tables by grouped vars to locate them in original dataset
  df_conc &lt;-<span class="st"> </span><span class="kw">left_join</span>(df_conc, conc_duplicates, <span class="dt">by =</span> grpvars)
  chk_conc_dup &lt;-<span class="st"> </span><span class="kw">filter</span>(df_conc, <span class="op">!</span><span class="kw">is.na</span>(n))
  
  df_conc &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(
    ## averages of duplicates
    df_conc <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(grpvars)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarize</span>(
        <span class="dt">value =</span> <span class="kw">mean</span>(value), 
        <span class="dt">detect_lim =</span> <span class="kw">mean</span>(detect_lim, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), 
        <span class="dt">quant_lim =</span>  <span class="kw">mean</span>(detect_lim, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
      ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>(),
    ## rows of conc data with no duplicates
    df_conc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>n)
  )
  
  ## remaining duplicates for biota datasets are due to dual wet/lipid weight records;
  ## of these, keep wet weight records, when has a value
  <span class="cf">if</span>(matrix_biota){
    chk &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">setdiff</span>(grpvars, <span class="kw">c</span>(<span class="st">&quot;basis_determination&quot;</span>, <span class="st">&quot;matrix_analyzed&quot;</span>)))) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">ww_val =</span> <span class="kw">any</span>(basis_determination <span class="op">==</span><span class="st"> &quot;wet weight&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(value))) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">mutate</span>(
        <span class="dt">rm_duplicate =</span> 
          (ww_val <span class="op">&amp;</span><span class="st"> </span>basis_determination <span class="op">==</span><span class="st"> &quot;lipid weight&quot;</span>)<span class="op">|</span>
<span class="st">          </span>(<span class="op">!</span>ww_val <span class="op">&amp;</span><span class="st"> </span>basis_determination <span class="op">==</span><span class="st"> &quot;wet weight&quot;</span>)
      ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">ungroup</span>()
    df_conc &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">left_join</span>(chk, <span class="dt">by =</span> <span class="kw">intersect</span>(<span class="kw">names</span>(df_conc), <span class="kw">names</span>(chk))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">rm_duplicate =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(rm_duplicate), <span class="ot">TRUE</span>, rm_duplicate)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(rm_duplicate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>n, <span class="op">-</span>ww_val, <span class="op">-</span>rm_duplicate)
  }
  
  ## do not want to spread the data because the qflag, detli etc is unique to each congener
  ## but, spread to check if one row for every unique sub_samp_ref for biota, samp_ref for sediment
  df_conc_wide &lt;-<span class="st"> </span>df_conc <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>detect_lim, <span class="op">-</span>quant_lim) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> value)
  <span class="cf">if</span>(<span class="kw">length</span>(<span class="kw">unique</span>(df_conc[[sampvars[<span class="kw">length</span>(sampvars)]]])) <span class="op">!=</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(df_conc_wide))){
    <span class="kw">message</span>(
      <span class="st">&quot;NOTE conc. subsamples not uniquely identified even after averaging; </span>
<span class="st">            multiple obs per ID, probably due to qflags</span><span class="ch">\n</span><span class="st">&quot;</span>
    )
  }
  
  ## for biota convert lipid weight measurements to wet weight ----
  ## UNITS HAVE ALL BEEN CONVERTED TO MICROGRAMS PER KILOGRAM
  ## use the df_bbio_wide datatable to convert values in df_conc table
  df_final &lt;-<span class="st"> </span><span class="kw">left_join</span>(df_conc, df_bbio_wide, <span class="dt">by =</span> <span class="kw">intersect</span>(grpvars, <span class="kw">names</span>(df_bbio_wide))) 
  
  <span class="cf">if</span>(matrix_biota){
    
    <span class="kw">message</span>(<span class="st">&quot;STEP 5: converting all congener concentrations in biota to wet weight, muscle equivalence&quot;</span>)
    
    ## for PFOS data convert liver values into those for muscle 
    ## using conversion values from Faxneld et al 2014
    ## https://www.diva-portal.org/smash/get/diva2:767385/FULLTEXT01.pdf)
    ## follow methods in the HELCOM core indicator p.9
    ## http://www.helcom.fi/Core%20Indicators/PFOS_HELCOM%20core%20indicator%202016_web%20version.pdf
    ## use the mean liver:muscle ratio for all species (17.9), see Table 8 in Faxneld et al 2014
    <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;FL&quot;</span>){
      df_final &lt;-<span class="st"> </span>df_final <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">mutate_at</span>(
          <span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;value&quot;</span>, <span class="st">&quot;detect_lim&quot;</span>, <span class="st">&quot;quant_lim&quot;</span>)), 
          <span class="kw">list</span>(<span class="dt">pfos_muscle_equiv =</span> <span class="op">~</span><span class="st"> </span><span class="kw">case_when</span>(
            variable <span class="op">==</span><span class="st"> &quot;PFOS&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">17.9</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFOS&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            
            ## NOT IN BHI1.0, BUT INCLUDING FOR INITIAL EXPLORATION...
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">13.4</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">6.13</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatilis&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">13.7</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFOA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatilis&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">19.4</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">5.69</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatiliss&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">5.69</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatilis&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">15.5</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Clupea harengus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">5.62</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Zoarces viviparus&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatilis&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">13.7</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFNA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>species <span class="op">==</span><span class="st"> &quot;Perca fluviatilis&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFPEDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">7.4</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFPEDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.,
            variable <span class="op">==</span><span class="st"> &quot;PFUnDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;liver&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">/</span><span class="fl">10.1</span>,
            variable <span class="op">==</span><span class="st"> &quot;PFUnDA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>matrix_analyzed <span class="op">==</span><span class="st"> &quot;muscle&quot;</span> <span class="op">~</span><span class="st"> </span>.
          ))
        ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">mutate_at</span>(
        <span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;value_pfos_muscle_equiv&quot;</span>, <span class="st">&quot;detect_lim_pfos_muscle_equiv&quot;</span>, <span class="st">&quot;quant_lim_pfos_muscle_equiv&quot;</span>)), 
        ## will probably all be in wet weight already, but just in case...
        <span class="kw">list</span>(<span class="dt">wet_wgt =</span> <span class="op">~</span><span class="st"> </span><span class="kw">case_when</span>(
          basis_determination <span class="op">==</span><span class="st"> &quot;lipid weight&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">*</span>(<span class="st">`</span><span class="dt">muscle_EXLIP%</span><span class="st">`</span><span class="op">/</span><span class="dv">100</span>), <span class="co"># IS THIS HOW EXLIP% VARIABLE WORKS??</span>
          basis_determination <span class="op">==</span><span class="st"> &quot;dry weight&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">*</span>(<span class="dv">100</span><span class="op">/</span><span class="st">`</span><span class="dt">muscle_DRYWT%</span><span class="st">`</span>), <span class="co"># IS THIS HOW DRYWT% VARIABLE WORKS????</span>
          basis_determination <span class="op">==</span><span class="st"> &quot;wet weight&quot;</span> <span class="op">~</span><span class="st"> </span>.
        ))
      )
    } <span class="cf">else</span> {
      df_final &lt;-<span class="st"> </span>df_final <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span>## if value is not wet weight convert, otherwise keep value
<span class="st">      </span><span class="kw">mutate_at</span>(
        <span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;value&quot;</span>, <span class="st">&quot;detect_lim&quot;</span>, <span class="st">&quot;quant_lim&quot;</span>)), 
        <span class="kw">list</span>(<span class="dt">wet_wgt =</span> <span class="op">~</span><span class="st"> </span><span class="kw">case_when</span>(
          basis_determination <span class="op">==</span><span class="st"> &quot;lipid weight&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">*</span>(<span class="st">`</span><span class="dt">EXLIP%</span><span class="st">`</span><span class="op">/</span><span class="dv">100</span>), <span class="co"># IS THIS HOW EXLIP% VARIABLE WORKS????</span>
          basis_determination <span class="op">==</span><span class="st"> &quot;dry weight&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">*</span>(<span class="dv">100</span><span class="op">/</span><span class="st">`</span><span class="dt">DRYWT%</span><span class="st">`</span>), <span class="co"># IS THIS HOW DRYWT% VARIABLE WORKS????</span>
          basis_determination <span class="op">==</span><span class="st"> &quot;wet weight&quot;</span> <span class="op">~</span><span class="st"> </span>.
        ))
      )
    }
    
  }
  ## for sediment data, still need to convert to dry weights
  <span class="cf">if</span>(<span class="op">!</span>matrix_biota){
    ## what to do with the dry weights....
    <span class="kw">message</span>(<span class="st">&quot;STEP 5: converting all congener concentrations in sediment to dry weight&quot;</span>)
    df_final &lt;-<span class="st"> </span>df_final <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span>## if value is not dry weight convert, otherwise keep value
<span class="st">      </span>## even though some have units of ug/kg treat the DRYWT% as percentage...
<span class="st">      </span><span class="kw">mutate_at</span>(
        <span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;value&quot;</span>, <span class="st">&quot;detect_lim&quot;</span>, <span class="st">&quot;quant_lim&quot;</span>)), 
        <span class="kw">list</span>(<span class="dt">dry_wgt =</span> <span class="op">~</span><span class="st"> </span><span class="kw">case_when</span>(
          basis_determination <span class="op">==</span><span class="st"> &quot;wet weight&quot;</span> <span class="op">~</span><span class="st"> </span>.<span class="op">*</span>(<span class="st">`</span><span class="dt">DRYWT%</span><span class="st">`</span><span class="op">/</span><span class="dv">100</span>), <span class="co"># IS THIS HOW DRYWT% VARIABLE WORKS????</span>
          basis_determination <span class="op">==</span><span class="st"> &quot;dry weight&quot;</span> <span class="op">~</span><span class="st"> </span>.
        ))
      )
  }
  
  ## rejoin with meta information ----
  ## rejoin with info on country and monitoring program info, qflaugs, etc
  <span class="kw">message</span>(<span class="st">&quot;FINAL STEP: rejoining with meta information</span><span class="ch">\n</span><span class="st">&quot;</span>)
  
  df_final &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(param_group, <span class="dt">pattern =</span> contam_param)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(
      country, monit_program, monit_purpose, 
      report_institute, 
      monit_year, date_ices, day, month,
      num_indiv_subsample, bulk_id,  
      <span class="op">!!!</span><span class="kw">syms</span>(grpvars)
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">right_join</span>(df_final, <span class="dt">by =</span> grpvars) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">qflagged =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(qflag), <span class="ot">FALSE</span>, <span class="ot">TRUE</span>))
  
  ## return wrangled data and checks ----
  
  ## list of checks as part of result
  chks &lt;-<span class="st"> </span><span class="kw">list</span>(
    chk_params, chk_ids, 
    chk_bbio_units, chk_num_bbio_dup, chk_bbio_vars,
    chk_conc_units, chk_num_conc_dup, chk_conc_dup
  )
  
  df_final &lt;-<span class="st"> </span><span class="kw">filter</span>(df_final, <span class="op">!</span><span class="kw">is.na</span>(value))
    
  <span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(<span class="kw">mutate</span>(<span class="kw">group_by</span>(df_final, <span class="op">!!!</span><span class="kw">syms</span>(grpvars)), <span class="dt">n =</span> <span class="kw">n</span>())<span class="op">$</span>n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)){
    <span class="kw">warning</span>(<span class="st">&quot;NOTE rows of final dataframe are not uniquely identified by grouping variables&quot;</span>)
  }
  
  <span class="kw">return</span>(<span class="kw">list</span>(
    <span class="dt">df_final =</span> df_final, 
    <span class="dt">groupingvars =</span> grpvars,
    <span class="dt">df_conc_wide =</span> df_conc_wide, 
    <span class="dt">df_bbio_wide =</span> df_bbio_wide, 
    <span class="dt">checks =</span> chks
  ))
}</code></pre></div>
<p><br></p>
</div>
<div id="wrangle-all-and-save" class="section level4 unnumbered">
<h4>2.2.3 Wrangle all and Save</h4>
<p>Apply the Standardization function defined above to all 5 Contaminants datasets and save the cleaned, harmonized data for later analysis. For PCBs in biota data, remove PCB, SCB, SCB7 variables as these are summarized data or depreciated codes; for PCBs in sediments remove PCB and SCB.</p>
<!-- ideally at this stage we would save to a postgres+postgis database; still in the process of building this database now -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dir_interm &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;CW&quot;</span>, <span class="st">&quot;contaminants&quot;</span>, version_year, <span class="st">&quot;intermediate&quot;</span>)

<span class="kw">lapply</span>(
  <span class="kw">list</span>(
    ## for param definitions see //vocab.ices.dk/?ref=37
    
    ## PCB datasets
    ## remove PCB, SCB, SCB7 - these are summarized data or depreciated codes
    ## OC-CB variable codes: vocab.ices.dk/?CodeID=26983
    <span class="kw">list</span>(<span class="st">&quot;pcb_bio&quot;</span>, <span class="ot">TRUE</span>, <span class="st">&quot;OC-CB&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;PCB&quot;</span>, <span class="st">&quot;SCB&quot;</span>, <span class="st">&quot;SCB7&quot;</span>)),
    <span class="kw">list</span>(<span class="st">&quot;pcb_sed&quot;</span>, <span class="ot">FALSE</span>, <span class="st">&quot;OC-CB&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;PCB&quot;</span>, <span class="st">&quot;SCB&quot;</span>)),
    
    ## Dioxin datasets
    <span class="kw">list</span>(<span class="st">&quot;dioxin_bio&quot;</span>, <span class="ot">TRUE</span>, <span class="st">&quot;OC-DX&quot;</span>, <span class="ot">NULL</span>),
    <span class="kw">list</span>(<span class="st">&quot;dioxin_sed&quot;</span>, <span class="ot">FALSE</span>, <span class="st">&quot;OC-DX&quot;</span>, <span class="ot">NULL</span>),

    ## PFOS dataset
    <span class="kw">list</span>(<span class="st">&quot;pfos_bio&quot;</span>, <span class="ot">TRUE</span>, <span class="st">&quot;O-FL&quot;</span>, <span class="ot">NULL</span>)
  ),
  
  <span class="cf">function</span>(dat){
    dat_final &lt;-<span class="st"> </span><span class="kw">standardize_con_data</span>(<span class="kw">get</span>(dat[[<span class="dv">1</span>]]), dat[[<span class="dv">2</span>]], dat[[<span class="dv">3</span>]], dat[[<span class="dv">4</span>]]) 
    <span class="kw">assign</span>(
      <span class="dt">x =</span> <span class="kw">paste</span>(dat[[<span class="dv">1</span>]], <span class="st">&quot;cleaned&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>), 
      <span class="dt">value =</span> dat_final, 
      <span class="dt">envir =</span> .GlobalEnv
    )
    <span class="kw">assign</span>(
      <span class="dt">x =</span> <span class="kw">paste</span>(dat[[<span class="dv">1</span>]], <span class="st">&quot;clean_df&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>), 
      <span class="dt">value =</span> dat_final[[<span class="st">&quot;df_final&quot;</span>]], 
      <span class="dt">envir =</span> .GlobalEnv
    )
    <span class="kw">write_csv</span>(
      dat_final[[<span class="st">&quot;df_final&quot;</span>]], 
      <span class="kw">file.path</span>(dir_interm, <span class="kw">paste</span>(dat[[<span class="dv">1</span>]], <span class="st">&quot;cleaned.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))
    )
  }
)</code></pre></div>
<hr />
</div>
</div>
<div id="initial-data-exploration" class="section level3 unnumbered">
<h3>2.3 Initial Data Exploration</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## to start running code from here, will need to load in cleaned  datasets...

<span class="co"># dir_interm &lt;- here::here(&quot;data/CW/contaminants/v2019/intermediate&quot;)</span>
<span class="co"># lapply(list.files(dir_interm), function(dat){</span>
<span class="co">#   dat_final &lt;- read_csv(file.path(dir_interm, dat))</span>
<span class="co">#   assign(</span>
<span class="co">#     x = str_replace(dat, &quot;cleaned.csv&quot;, &quot;clean_df&quot;),</span>
<span class="co">#     value = dat_final,</span>
<span class="co">#     envir = .GlobalEnv</span>
<span class="co">#   )</span>
<span class="co"># })</span>

make_plotdf &lt;-<span class="st"> </span><span class="cf">function</span>(x, yrs){
  
  grpvars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;variable&quot;</span>, <span class="st">&quot;num_distinct_dates&quot;</span>, <span class="st">&quot;species&quot;</span>)
  valvar &lt;-<span class="st"> &quot;value_wet_wgt&quot;</span>
  <span class="cf">if</span>(<span class="kw">str_detect</span>(x, <span class="st">&quot;sed&quot;</span>)){
    grpvars &lt;-<span class="st"> </span><span class="kw">setdiff</span>(grpvars, <span class="st">&quot;species&quot;</span>)
    valvar &lt;-<span class="st"> &quot;value_dry_wgt&quot;</span>
  }
  <span class="cf">if</span>(<span class="kw">str_detect</span>(x, <span class="st">&quot;pfos&quot;</span>)){
    valvar &lt;-<span class="st"> &quot;value_pfos_muscle_equiv_wet_wgt&quot;</span>
  }
  <span class="kw">cbind</span>(
    <span class="kw">get</span>(x) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="op">!!!</span><span class="kw">syms</span>(valvar))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span>yrs, longitude <span class="op">&gt;</span><span class="st"> </span><span class="dv">9</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(latitude, longitude, variable) <span class="op">%&gt;%</span>
<span class="st">      </span>## number of disinct dates at the location for the variable
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">num_distinct_dates =</span> <span class="kw">n_distinct</span>(date)) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(grpvars)) <span class="op">%&gt;%</span>
<span class="st">      </span>## mean annual values at the locatioin, by variable
<span class="st">      </span><span class="kw">summarize</span>(
        <span class="dt">mean_val =</span> <span class="kw">ifelse</span>(
          <span class="kw">str_detect</span>(x, <span class="st">&quot;sed&quot;</span>), 
          <span class="kw">mean</span>(value_dry_wgt), 
          <span class="kw">ifelse</span>(
            <span class="kw">str_detect</span>(x, <span class="st">&quot;pfos&quot;</span>),
            <span class="kw">mean</span>(value_pfos_muscle_equiv_wet_wgt), 
            <span class="kw">mean</span>(value_wet_wgt)
          )
        )
      ) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">ungroup</span>(),
    <span class="dt">source =</span> <span class="kw">str_to_upper</span>(<span class="kw">str_remove</span>(x, <span class="st">&quot;_clean_df&quot;</span>)))
}
## apply make_plotdf bringing all datasets together 
plotdf &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(
  <span class="kw">do.call</span>(
    rbind, 
    <span class="kw">lapply</span>(
      <span class="kw">list</span>(<span class="st">&quot;pcb_bio_clean_df&quot;</span>, <span class="st">&quot;dioxin_bio_clean_df&quot;</span>, <span class="st">&quot;pfos_bio_clean_df&quot;</span>), 
      <span class="cf">function</span>(x) <span class="kw">make_plotdf</span>(x, <span class="dv">2014</span><span class="op">:</span><span class="dv">2019</span>)
    )) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">matrix =</span> <span class="st">&quot;biota&quot;</span>, <span class="dt">indicator =</span> <span class="kw">str_remove</span>(source, <span class="st">&quot;_[A-Z].*&quot;</span>)),
  <span class="kw">do.call</span>(
    rbind, 
    <span class="kw">lapply</span>(
      <span class="kw">list</span>(<span class="st">&quot;pcb_sed_clean_df&quot;</span>, <span class="st">&quot;dioxin_sed_clean_df&quot;</span>), 
      <span class="cf">function</span>(x) <span class="kw">make_plotdf</span>(x, <span class="dv">2014</span><span class="op">:</span><span class="dv">2019</span>)
    )) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">matrix =</span> <span class="st">&quot;sediment&quot;</span>, <span class="dt">indicator =</span> <span class="kw">str_remove</span>(source, <span class="st">&quot;_[A-Z].*&quot;</span>))
)</code></pre></div>
<p><br></p>
<div id="spatial-distributions-of-measurements-.tabset-.tabset-fade-.tabset-pills" class="section level4 unnumbered">
<h4>2.3.2 Spatial Distributions of Measurements {.tabset .tabset-fade .tabset-pills}</h4>
<p>The maps below show data distribution spatially. Size and color correspond to number of distinct dates measurements were collected for a variable, for the given location within the specified time period (2016 through 2019); larger points with more yellow color indicate greater number of observations while smaller more red points indicate fewer observations. Opacity corresponds to number of years with greater transparency indicating fewer years of data. These faceted plots are created for multiple species; the species selected for visualization are those with the greatest number of measurements recorded across the three indicators.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_map &lt;-<span class="st"> </span><span class="cf">function</span>(mapdata){
  
  ## make data spatial using lat/lon columns
  df &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_as_sf</span>(
    <span class="dt">x =</span> mapdata, 
    <span class="dt">agr =</span> <span class="st">&quot;identity&quot;</span>,
    <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), 
    <span class="dt">crs =</span> <span class="dv">4326</span>
  )
  ## contaminants datasets overlaying basemap
  speciesmap &lt;-<span class="st"> </span>basemap <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_sf</span>(
      <span class="dt">data =</span> df,
      <span class="kw">aes</span>(
        <span class="dt">size =</span> num_distinct_dates,
        <span class="dt">color =</span> num_distinct_dates), 
      <span class="dt">show.legend =</span> <span class="ot">FALSE</span>,
      <span class="dt">alpha =</span> <span class="fl">0.5</span>, 
      <span class="dt">shape =</span> <span class="dv">19</span>
    ) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_gradient2</span>(
      <span class="dt">low =</span> <span class="st">&quot;red3&quot;</span>, 
      <span class="dt">mid =</span> <span class="st">&quot;lightcoral&quot;</span>,
      <span class="dt">high =</span> <span class="st">&quot;lightgoldenrod&quot;</span>,
      <span class="dt">midpoint =</span> <span class="fl">2.5</span>
    ) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(
      <span class="kw">c</span>(<span class="st">&quot;indicator&quot;</span>, <span class="st">&quot;variable&quot;</span>), 
      <span class="dt">labeller =</span> <span class="kw">label_wrap_gen</span>(<span class="dt">width =</span> <span class="dv">35</span>, <span class="dt">multi_line =</span> <span class="ot">FALSE</span>), 
      <span class="dt">ncol =</span> <span class="dv">5</span>
    )

  <span class="kw">return</span>(speciesmap)
}
<span class="co"># for(i in unique(plotdf$indicator)){</span>
<span class="co">#   species_obs &lt;- plotdf %&gt;%</span>
<span class="co">#     filter(matrix == &quot;biota&quot;, indicator == i) %&gt;%</span>
<span class="co">#     group_by(species) %&gt;%</span>
<span class="co">#     summarise(n = sum(num_distinct_dates)) %&gt;%</span>
<span class="co">#     arrange(desc(n))</span>
<span class="co">#   print(head(species_obs))</span>
<span class="co"># }</span></code></pre></div>
<p><br></p>
<div id="clupea-harengus" class="section level5 unnumbered">
<h5>Clupea Harengus</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Clupea harengus&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20herring-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="zoarces-viviparus" class="section level5 unnumbered">
<h5>Zoarces Viviparus</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Zoarces viviparus&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20eelpout-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="perca-fluviatilis" class="section level5 unnumbered">
<h5>Perca Fluviatilis</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Perca fluviatilis&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20perch-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="platichthys-flesus" class="section level5 unnumbered">
<h5>Platichthys Flesus</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Platichthys flesus&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20flounder-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="mytilus-edulis" class="section level5 unnumbered">
<h5>Mytilus Edulis</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Mytilus edulis&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20blue%20muscles-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="uria-aalge" class="section level5 unnumbered">
<h5>Uria Aalge</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;biota&quot;</span>, <span class="kw">str_detect</span>(species, <span class="st">&quot;Uria aalge&quot;</span>)))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20common%20murre-1.png" width="1056" /></p>
<hr />
<p><br></p>
</div>
<div id="sediments" class="section level5 unnumbered">
<h5>Sediments</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_map</span>(<span class="kw">filter</span>(plotdf, matrix <span class="op">==</span><span class="st"> &quot;sediment&quot;</span>))</code></pre></div>
<p><img src="bhi-prep_files/figure-html/sampling%20maps%20sediments-1.png" width="1056" /></p>
<hr />
<p><br></p>
<p><br/></p>
</div>
</div>
</div>
</div>
<div id="wrangling-evaluation-and-gapfilling" class="section level2 unnumbered">
<h2>3. Wrangling, Evaluation, and Gapfilling</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_clean_df &lt;-<span class="st"> </span><span class="cf">function</span>(filename){
  <span class="kw">read_csv</span>(
    <span class="kw">file.path</span>(<span class="kw">dirname</span>(data_path), <span class="st">&quot;intermediate&quot;</span>, filename),
    ## ensure column types are read correctly...
    <span class="dt">col_types =</span> <span class="kw">cols</span>(
      <span class="dt">bulk_id =</span> <span class="kw">col_character</span>(),
      <span class="dt">qflag =</span> <span class="kw">col_character</span>(),
      <span class="st">`</span><span class="dt">LIPIDWT%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_number</span>(),
      <span class="st">`</span><span class="dt">DRYWT%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_number</span>(),
      <span class="st">`</span><span class="dt">EXLIP%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_number</span>(),
      <span class="dt">WTMEA =</span> <span class="kw">col_number</span>(),
      <span class="dt">WTMIN =</span> <span class="kw">col_number</span>(),
      <span class="dt">WTMAX =</span> <span class="kw">col_number</span>(),
      <span class="dt">sub_samp_id =</span> <span class="kw">col_number</span>(),
      <span class="dt">LNMEA =</span> <span class="kw">col_number</span>(), 
      <span class="dt">LNMAX =</span> <span class="kw">col_number</span>(),
      <span class="dt">LNMIN =</span> <span class="kw">col_number</span>(),
      <span class="dt">unit =</span> <span class="kw">col_character</span>()
    )
  )
}</code></pre></div>
<!-- **Station Impact Codes** -->
<!-- Note: as of `BHI2.0` the original station library has been replaced by a new web application -->
<!-- [Site monitoring purpose](https://vocab.ices.dk/?ref=42) `monit_purpose` vocabulary reference for codes. -->
<!-- Some sites have had the site type recorded in the ICES station dictionary ([see ICES vocabulary reference for codes](https://vocab.ices.dk/?ref=177). It is pertinent to know which sites are catagorized as:   -->
<!-- **RH** = WFD R(HZ) - Representative of general conditions in terms of hazardous substances   -->
<!-- **B** = WFD B - Baseline/Reference station   -->
<!-- **Any of the codes containing "I"** (Starting with IH or IP) which refers to a specific type of impact at the site.   -->
<!-- **RP** = WFD R(PHY) - Representative of general conditions for nutrients/organic matter  -->
<!-- It appears that only Swedish sites have this information entered. Given only Swedish sites have this information recorded, it seems difficult to use this information to include or exclude sites.   -->
<!-- From the station dictionary definitions: -->
<!-- All_Biota_Data: Data type (DTYPE) CF - all parameters - contaminants and biological effects of contaminants including disease in biota   -->
<!-- Contaminant_parameters_in_biota: Data type (DTYPE) CF - Contaminant parameter groups   -->
<hr />
<p><br></p>
<div id="pcb-indicator" class="section level3 unnumbered">
<h3>3.1 PCB Indicator</h3>
<div id="match-bhi-regions" class="section level4 unnumbered">
<h4>3.1.1 Match BHI Regions</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## use &#39;read_clean_df&#39; function from above to read cleaned data with correct data types for columns
## use &#39;join_rgns_info&#39; helper function defined in R/spatial.R
pcb_bio &lt;-<span class="st"> </span><span class="kw">join_rgns_info</span>(
  <span class="kw">read_clean_df</span>(<span class="st">&quot;pcb_bio_cleaned.csv&quot;</span>),
  <span class="dt">latlon_vars =</span> <span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>),
  <span class="dt">rgn_shps_loc =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>),
  <span class="dt">return_spatial =</span> <span class="ot">FALSE</span>,
  <span class="dt">buffer_shp =</span> buffer_sf
)
pcb_sed &lt;-<span class="st"> </span><span class="kw">join_rgns_info</span>(
  <span class="kw">read_clean_df</span>(<span class="st">&quot;pcb_sed_cleaned.csv&quot;</span>),
  <span class="dt">latlon_vars =</span> <span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>),
  <span class="dt">rgn_shps_loc =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>),
  <span class="dt">return_spatial =</span> <span class="ot">FALSE</span>,
  <span class="dt">buffer_shp =</span> buffer_sf
)</code></pre></div>
</div>
<div id="filter-pcbs-to-ices6-set-or-pcb7-for-sediment" class="section level4 unnumbered">
<h4>3.1.2 Filter PCBs to ICES6 Set or PCB7 for Sediment</h4>
<p>The PCBs indicator uses only the ICES6 congeners: CB28, CB52, CB101, CB138, CB153, CB180. Additionally, only herring are used from the biota datasets, as they are fairly equally spatially distributed across the baltic sea, while many other species are predominantly in the south.</p>
<p><br></p>
<div id="checking-outliersquestionable-measurements-.tabset-.tabset-fade-.tabset-pills" class="section level5 unnumbered">
<h5>Checking Outliers/Questionable Measurements {.tabset .tabset-fade .tabset-pills}</h5>
<div id="pcbs-in-biota" class="section level6 unnumbered">
<h6>PCBs in Biota</h6>
<p><img src="bhi-prep_files/figure-html/checking%20pcb%20bio%20data%20and%20outliers-1.png" width="960" /></p>
<hr />
<p><br></p>
</div>
<div id="pcbs-in-sediment" class="section level6 unnumbered">
<h6>PCBs in Sediment</h6>
<p><img src="bhi-prep_files/figure-html/checking%20pcb%20sed%20data%20and%20outliers-1.png" width="960" /></p>
<hr />
<p><br></p>
</div>
</div>
<div id="visualize-flagged-data-in-timeseries" class="section level5 unnumbered">
<h5>Visualize flagged data in Timeseries</h5>
<p>Below the data are plotted in congener-subbasin combinations. Colorscale corresponds to number of observations, with lighter blues/greens indicating more observations for the given date-congener-subbasin group, while darker colors indicate fewer observations in the dataset for the given date-congener-subbasin combination.</p>
<hr />
<p><br></p>
</div>
</div>
<div id="evaluate-flagged-data-station-impact-sampling-patterns" class="section level4 unnumbered">
<h4>3.1.3 Evaluate Flagged Data, Station Impact, &amp; Sampling Patterns</h4>
<p><br></p>
<p><strong>What do the <code>qflags</code> indicate? Quantification limits, Flags Codes</strong></p>
<ul>
<li><p><strong>&lt;</strong> = less than</p></li>
<li><p><strong>&gt;</strong> = greather than</p></li>
<li><p><strong>D</strong> = reported value is less than the detection limit (detect_lim)</p></li>
<li><p><strong>Q</strong> = reported value is less than the limit of quantification (quant_lim)</p></li>
<li><p><strong>~</strong> separates multiple flags</p></li>
</ul>
<p><img src="bhi-prep_files/figure-html/what%20do%20the%20qflags%20indicate-1.png" width="912" /></p>
<hr />
<p><br></p>
<div id="congener-sums-timeseries-by-country-.tabset-.tabset-fade-.tabset-pills" class="section level5 unnumbered">
<h5>Congener-Sums Timeseries by Country {.tabset .tabset-fade .tabset-pills}</h5>
<p><strong>Defining two approaches to deal with flagged data</strong></p>
<p>The function below aggregates the data spreading by variable (so each congner has a column and each date/location/sample is a single row) and summing the congeners rowwise to get date/location/sample specific concentration sums of the specified congners. The function allows for two approaches to handling flagged data: “NoQflag” which removes the flagged observations or “Adjusted” which adjust values. Adjustment of values would ideally use detect_lim/2, however since detect_lim values are not always provided, we apply the transformation to the reported data value.</p>
<!-- To visualize by country or basin pass "country" or "subbasin" respectively to `cntry_or_basin` arguement  -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## timeseries plots, congeners by country
plot_cwcon_initial &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_pal, <span class="dt">contam_param =</span> <span class="st">&quot;OC-CB&quot;</span>, <span class="dt">matrix =</span> <span class="st">&quot;bio&quot;</span>, <span class="dt">cntry_or_basin =</span> <span class="st">&quot;subbasin&quot;</span>){
  
  ## one of OC-CB, OC-DX or O-FL; becomes OC, DX, or FL respectively
  contam_param &lt;-<span class="st"> </span><span class="kw">substr</span>(contam_param, <span class="kw">str_length</span>(contam_param)<span class="op">-</span><span class="dv">1</span>, <span class="kw">str_length</span>(contam_param))
  <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;FL&quot;</span>){contam_param &lt;-<span class="st"> &quot;PF&quot;</span>}
  <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;DX&quot;</span>){contam_param &lt;-<span class="st"> &quot;CD&quot;</span>}
  cntry_or_basin &lt;-<span class="st"> </span><span class="kw">str_to_lower</span>(cntry_or_basin)
  
  dat &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">subbasin =</span> Subbasin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(month, <span class="dt">Year =</span> year, <span class="dt">zone =</span> cntry_or_basin, <span class="kw">contains</span>(contam_param)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(zone), Year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(
      <span class="dt">cols =</span> <span class="kw">starts_with</span>(contam_param), 
      <span class="dt">names_to =</span> <span class="st">&quot;Congener&quot;</span>, 
      <span class="dt">values_to =</span> <span class="st">&quot;value_plot&quot;</span>
    ) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw">group_by</span>(Congener, month, Year, zone) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Value =</span> <span class="kw">mean</span>(value_plot, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">as.Date</span>(<span class="kw">paste</span>(<span class="st">&quot;1&quot;</span>, month, Year, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>), <span class="dt">tryFormats =</span> <span class="st">&quot;%d-%m-%Y&quot;</span>))
  
  ## reorder factor levels of congeners so colors will match across plots for same congeners
  <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;CB&quot;</span>){
    <span class="cf">if</span>(<span class="kw">isTRUE</span>(<span class="kw">all.equal</span>(<span class="kw">names</span>(<span class="kw">select</span>(dataset, <span class="kw">starts_with</span>(contam_param))), ices6_congeners))){
      dat<span class="op">$</span>Congener &lt;-<span class="st"> </span><span class="kw">factor</span>(dat<span class="op">$</span>Congener, <span class="dt">levels =</span> ices6_congeners)
    }
    <span class="cf">if</span>(<span class="kw">isTRUE</span>(<span class="kw">all.equal</span>(<span class="kw">names</span>(<span class="kw">select</span>(dataset, <span class="kw">starts_with</span>(contam_param))), pcb7sed_congeners))){
      dat<span class="op">$</span>Congener &lt;-<span class="st"> </span><span class="kw">factor</span>(dat<span class="op">$</span>Congener, <span class="dt">levels =</span> <span class="kw">c</span>(ices6_congeners, <span class="st">&quot;CB118&quot;</span>))
    }
    dioxinlike_pcbs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CB118&quot;</span>,<span class="st">&quot;CB156&quot;</span>,<span class="st">&quot;CB105&quot;</span>,<span class="st">&quot;CB169&quot;</span>,<span class="st">&quot;CB167&quot;</span>,<span class="st">&quot;CB77&quot;</span>,<span class="st">&quot;CB157&quot;</span>)
    <span class="cf">if</span>(<span class="kw">isTRUE</span>(<span class="kw">all.equal</span>(<span class="kw">names</span>(<span class="kw">select</span>(dataset, <span class="kw">starts_with</span>(contam_param))), dioxinlike_pcbs))){
      dat<span class="op">$</span>Congener &lt;-<span class="st"> </span><span class="kw">factor</span>(dat<span class="op">$</span>Congener, <span class="dt">levels =</span> dioxinlike_pcbs)
    }
  }
  <span class="cf">if</span>(contam_param <span class="op">==</span><span class="st"> &quot;CD&quot;</span>){
    sed_dioxins &lt;-<span class="st"> </span><span class="kw">c</span>(
      <span class="st">&quot;CDD1N&quot;</span>,<span class="st">&quot;CDD4X&quot;</span>,<span class="st">&quot;CDD6P&quot;</span>,<span class="st">&quot;CDD6X&quot;</span>,<span class="st">&quot;CDD9X&quot;</span>,<span class="st">&quot;CDDO&quot;</span>,<span class="st">&quot;CDF2N&quot;</span>,<span class="st">&quot;CDF2T&quot;</span>,
      <span class="st">&quot;CDF4X&quot;</span>,<span class="st">&quot;CDF6P&quot;</span>,<span class="st">&quot;CDF6X&quot;</span>,<span class="st">&quot;CDF9P&quot;</span>,<span class="st">&quot;CDF9X&quot;</span>,<span class="st">&quot;CDFO&quot;</span>,<span class="st">&quot;TCDD&quot;</span>
    )
    <span class="cf">if</span>(matrix <span class="op">==</span><span class="st"> &quot;sed&quot;</span>){
      dat<span class="op">$</span>Congener &lt;-<span class="st"> </span><span class="kw">factor</span>(dat<span class="op">$</span>Congener, <span class="dt">levels =</span> sed_dioxins)
    } <span class="cf">else</span> {dat<span class="op">$</span>Congener &lt;-<span class="st"> </span><span class="kw">factor</span>(dat<span class="op">$</span>Congener, <span class="dt">levels =</span> <span class="kw">c</span>(sed_dioxins, <span class="st">&quot;CDFDN&quot;</span>))}
  }
  
  
  ## timeseries plots of all congeners by country
  plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(Date, Value, <span class="dt">fill =</span> Congener)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_date</span>(
      <span class="dt">breaks =</span> <span class="cf">function</span>(x){<span class="kw">seq.Date</span>(<span class="dt">from =</span> <span class="kw">min</span>(dat<span class="op">$</span>Date), <span class="dt">to =</span> <span class="kw">max</span>(dat<span class="op">$</span>Date), <span class="dt">by =</span> <span class="st">&quot;3 months&quot;</span>)},
      <span class="dt">date_labels =</span> <span class="st">&quot;%b %Y&quot;</span>
    ) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> col_pal) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">size =</span> <span class="dv">6</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>zone, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)
  
  <span class="kw">return</span>(plot) <span class="co"># return(plotly::ggplotly(plot))</span>
}</code></pre></div>
<p><br></p>
<p><strong>Visualize Timeseries, Monthly Sums</strong></p>
<div id="pcb-congeners-in-biota" class="section level6 unnumbered">
<h6>PCB Congeners in Biota</h6>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create color palettes
fullpal &lt;-<span class="st"> </span><span class="kw">c</span>(
  RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>),
  RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Set1&quot;</span>)
)
cols &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(fullpal)(<span class="dv">42</span>)[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">42</span>, <span class="dt">size =</span> <span class="dv">6</span>)]
<span class="kw">plot_cwcon_initial</span>(pcb_bio_qflag_adjust, <span class="dt">col_pal =</span> cols, <span class="dt">contam_param =</span> <span class="st">&quot;OC-CB&quot;</span>, <span class="dt">cntry_or_basin =</span> <span class="st">&quot;country&quot;</span>)</code></pre></div>
<p><img src="bhi-prep_files/figure-html/congeners%20timeseries%20monthly%20by%20basin%20for%20biota-1.png" width="912" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plotly::ggplotly(plot_cwcon_initial(pcb_bio_qflag_adjust, col_pal = cols, contam_param = &quot;OC-CB&quot;, cntry_or_basin = &quot;country&quot;))</span></code></pre></div>
<hr />
<p><br></p>
</div>
<div id="pcb-congeners-in-sediments" class="section level6 unnumbered">
<h6>PCB Congeners in Sediments</h6>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_cwcon_initial</span>(pcb_sed_qflag_adjust, <span class="kw">c</span>(cols, <span class="st">&quot;turquoise&quot;</span>), <span class="st">&quot;OC-CB&quot;</span>, <span class="st">&quot;sed&quot;</span>, <span class="st">&quot;country&quot;</span>)</code></pre></div>
<p><img src="bhi-prep_files/figure-html/congeners%20timeseries%20monthly%20by%20basin%20for%20sediments-1.png" width="912" /></p>
<hr />
<p><br></p>
</div>
</div>
<div id="spatial-distributions-of-pcb-sampling-locations" class="section level5 unnumbered">
<h5>Spatial distributions of PCB sampling Locations</h5>
<p><img src="bhi-prep_files/figure-html/map%20spatial%20dist%20of%20PCBs%20multiple%20years-1.png" width="120%" /></p>
<hr />
<p><br></p>
</div>
</div>
<div id="status-and-trend-options" class="section level4 unnumbered">
<h4>3.1.4 Status and Trend Options</h4>
<p><strong>Most-recent Years in Data Layers for each Approach to Flagged Data</strong></p>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_Adjusted
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_NoQflag
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Subbasin
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Aland Sea
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2015
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2015
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Arkona Basin
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Bay of Mecklenburg
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Bornholm Basin
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Bothnian Bay
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Bothnian Sea
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Eastern Gotland Basin
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Gdansk Basin
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Great Belt
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Gulf of Finland
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Gulf of Riga
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Kattegat
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Kiel Bay
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2016
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Northern Baltic Proper
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2016
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
The Quark
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2008
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2008
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
The Sound
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; border-bottom: 2px solid grey; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; border-bottom: 2px solid grey; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; border-bottom: 2px solid grey; text-align: left;">
Western Gotland Basin
</td>
</tr>
</tbody>
</table>
<hr />
<p><br></p>
<p><strong>A function to calculate the Indicators</strong></p>
<p>The function below takes as inputs: datalayer, years across which data is to be aggregated in status calculation, the biota reference point for the contaminant (health threshold in same units as datalayer values) and the sediment reference point, the trend-calculation approach, and trend lag i.e. the number of years we want to project into the future. Default approach for calculating the trend (scaledObs) is to scale the observations by the matrix-and-contaminant-specific reference point, capping at one, then group by spatial unit (BHI region or Subbasin) and matrix, and regress the scaled values against year; the year coefficient multiplied by <code>trendlag</code> becomes the trend score. Other approaches considered are: calculating trend with zscores of data, or using a mixed-effects model to try to account for different stations. See commented code below for more details.</p>
<p><strong>Compare two approaches to deal with flagged data, for BHI regions vs Basin</strong></p>
<ol style="list-style-type: decimal">
<li>Start with mean ICES6 conc. by date and location (unique observations)</li>
<li>Scale observations compared to the relevant contaminant-and-matrix-relevant reference point, capping at one</li>
<li>Calculate status as mean of all scaled obs. for past 5 years in either BHI region or basin</li>
<li>Compare by-basin and by-BHI region results for status and for trend, assess number of data points contributing</li>
</ol>
<p><img src="bhi-prep_files/figure-html/investigate%20approaches%20to%20qflags%20and%20summarizing%20by%20region%20vs%20basin%20pcb%20indicator-1.png" width="912" /></p>
<p><br></p>
</div>
<div id="save-pcb-contaminants-layer-and-intermediate-datasets" class="section level4 unnumbered">
<h4>3.1.5 Save PCB contaminants layer and intermediate datasets</h4>
<p><br></p>
</div>
<div id="methods-discussion" class="section level4 unnumbered">
<h4>3.1.6 Methods discussion</h4>
<p>Only herring (no other species) used from biota dataset, because herring are most equally spatially spaced across the baltic sea, whereas others are mostly in the south.</p>
<p><strong>Status formula, ICES6 PCBs Biota and 7PCBs in Sediment</strong></p>
<p><span class="math inline">\(X_{\mbox{ICES6}} = \min\{\mbox{bio_reference_point/mean_ICES6_region, } 1\}\)</span></p>
<p><span class="math inline">\(X_{\mbox{7sedPCB}} = \min\{\mbox{sed_reference_point/mean_7sedPCB_region, } 1\}\)</span></p>
<p><span class="math inline">\(X_{\mbox{PCB}} = (X_{\mbox{ICES6}} + X_{\mbox{7sedPCB}})/2\)</span></p>
<p><span class="math inline">\(\mbox{bio_reference_point} = \mbox{health_threshold} = 75ug/kg\mbox{ wet weight}\)</span></p>
<p><span class="math inline">\(\mbox{sed_reference_point} = \mbox{health_threshold} = 4.1ug/kg\mbox{ dry weight}\)</span></p>
<p>Score scaled between 0 and 1. If value is below 75, score = 1.</p>
<p><br></p>
<p><strong>Conclusions &amp; Decisions regarding Status and Trend Options</strong></p>
<ul>
<li>Including the qflag-adjusted values lowers the mean concentration by date and location</li>
<li>Including qflag-adjusted values also provides more observations in the Kattegat, The Quark, and W. Gotland Basin</li>
<li>When aggregating by BHI regions, more observations for Regions 1, 11, 26, 35, 36, 39, 41, 42 when including qflagged values</li>
<li><p>Using data including qflag-adjusted (this could lower values),</p></li>
<li>Use 5 year mean ICES6 concentration for status</li>
<li><p>Use the five status years plus another five prior for the regression that factors into trend calculation</p></li>
</ul>
<p><br></p>
<p><strong>Trend Considerations</strong></p>
<ul>
<li>Work on mixed effect model for trends?<br />
</li>
<li>Need to think about the interpretation of the data treatment. (a) If use raw observations, then normalize (zscore data), then fit trend, if get increase or decrease but all values are below the threshold, does it make sense to apply a change in the trend to the status? Would we really think the future status will be lower? (b) If take all raw observations, calculate “status” as done for the mean value, then fit trend, is this more true to the idea that variation below the human health threshold should not affect the trajectory of the future status?<br />
</li>
<li>Need to think if simple linear regression is okay, or if need to account for site?</li>
</ul>
<p><br></p>
<p><strong><code>BHI1.0</code> discussions with Anna Sobek </strong></p>
<ul>
<li>Indicator choice: We agreed that <em>ICES6 is the best</em> option<br />
</li>
<li>Decision about use of qflagg-adjusted data: <em>use qflagged data with the adjustement</em> of (congener conc/2)<br />
</li>
<li>Decision about spatial scale of the data: decide best approach is to <em>calculate for each basin</em><br />
</li>
<li>Trend decision: best approach is first convert individual observations to a “status” relative to the human health threshold, then fit linear model by basin for <strong>10 year period</strong>. (Tred Check: Does the trend value need to be rescaled to between -1 and 1? Does not exceed now but need to consider if method broadly works?)</li>
</ul>
<!-- **`BHI2.0` discussions with Anna Sobek ** -->
<hr />
<p><br></p>
</div>
</div>
<div id="pfos-indicator-1" class="section level3 unnumbered">
<h3>3.2 PFOS Indicator</h3>
<div id="match-bhi-regions-1" class="section level4 unnumbered">
<h4>3.2.1 Match BHI Regions</h4>
<p><strong>Use Lat/Long to Match BHI Regions</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use &#39;join_rgns_info&#39; helper function defined in spatial.R</span>
pfos &lt;-<span class="st"> </span><span class="kw">join_rgns_info</span>(
  <span class="kw">read_clean_df</span>(<span class="st">&quot;pfos_bio_cleaned.csv&quot;</span>),
  <span class="dt">helcomID_col =</span> <span class="st">&quot;HELCOM_ID&quot;</span>,
  <span class="dt">latlon_vars =</span> <span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>),
  <span class="dt">rgn_shps_loc =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>),
  <span class="dt">return_spatial =</span> <span class="ot">FALSE</span>,
  <span class="dt">buffer_shp =</span> buffer_sf
)</code></pre></div>
</div>
<div id="filter-organofluorines-data-keeping-only-pfos-in-clupea-harengus" class="section level4 unnumbered">
<h4>3.2.2 Filter Organofluorines Data keeping only PFOS in Clupea harengus</h4>
<p>Only herring (Clupea harengus) are used from the biota datasets, as they are fairly equally spatially distributed across the baltic sea, while many other species are predominantly in the south. Also, heerring are . In the raw organofluorine dataset, matrix analyzed for most measurements was liver but there were some also where muscle was analyzed. In the initial data cleaning (see <code>bhi-prep/data/CW/contaminants/v2019/con_data.rmd</code>), the concentrations from liver measurements were converted to muscle equivalent using the report: <a href="https://www.diva-portal.org/smash/get/diva2:767385/FULLTEXT01.pdf">Distribution of PFAS in liver and muscle of herring, perch, cod, eelpout, arctic char, and pike from limnic and marine environments in Sweden. Faxneld et al 2014</a>.</p>
</div>
<div id="evaluate-flagged-data-sampling-patterns" class="section level4 unnumbered">
<h4>3.2.3 Evaluate Flagged Data &amp; Sampling Patterns</h4>
<div id="visualize-pfos-flagged-data-in-timeseries" class="section level5 unnumbered">
<h5>Visualize PFOS flagged data in Timeseries</h5>
<p>PFOS data plotted by subbasin. Colorscale in plot one corresponds to number of observations, with lighter blues/greens indicating more observations for the given date-congener-subbasin group, while darker colors indicate fewer observations in the dataset for the given date-congener-subbasin combination. Plot 2 shows the same information in boxplot format, with data grouped by year.</p>
<div id="concentrations-timeseries-and-boxplots-with-observation-counts" class="section level6 unnumbered">
<h6>Concentrations Timeseries and Boxplots with Observation Counts</h6>
<hr />
<p><br></p>
</div>
</div>
<div id="spatial-distributions-of-pfos-sampling-locations-years-2014-2018" class="section level5 unnumbered">
<h5>Spatial distributions of PFOS sampling Locations, Years 2014-2018</h5>
<p><img src="bhi-prep_files/figure-html/pfos%20map%20of%20data%20records-1.png" width="120%" /></p>
<hr />
<p><br></p>
</div>
</div>
<div id="status-and-trend-options-1" class="section level4 unnumbered">
<h4>3.2.4 Status and Trend Options</h4>
<p><strong>Most-recent Years in Data Layers for each Approach to Flagged Data</strong></p>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_Adjusted
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_NoQflag
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Subbasin
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Aland Sea
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Arkona Basin
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Bornholm Basin
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Bothnian Bay
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Bothnian Sea
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Eastern Gotland Basin
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2018
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2018
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Gulf of Finland
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
Kattegat
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; text-align: right;">
2017
</td>
<td style="padding-left: 5em; padding-right: 2em; text-align: center;">
2017
</td>
<td style="padding-left: 14em; padding-right: 9em; text-align: left;">
Northern Baltic Proper
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: right;">
2016
</td>
<td style="padding-left: 5em; padding-right: 2em; background-color: #f7f7f7; text-align: center;">
2016
</td>
<td style="padding-left: 14em; padding-right: 9em; background-color: #f7f7f7; text-align: left;">
The Quark
</td>
</tr>
<tr>
<td style="padding-left: 5em; padding-right: 2em; border-bottom: 2px solid grey; text-align: right;">
2014
</td>
<td style="padding-left: 5em; padding-right: 2em; border-bottom: 2px solid grey; text-align: center;">
2014
</td>
<td style="padding-left: 14em; padding-right: 9em; border-bottom: 2px solid grey; text-align: left;">
Western Gotland Basin
</td>
</tr>
</tbody>
</table>
<hr />
<p><br></p>
<p><strong>Compare two approaches to deal with flagged data, for BHI regions vs Basin</strong></p>
<ol style="list-style-type: decimal">
<li>Start with mean concentrations by date and location</li>
<li>Scale observations compared to the relevant contaminant-and-matrix-relevant reference point, capping at one</li>
<li>Calculate status as mean of all scaled obs. for past 5 years in either BHI region or basin</li>
<li>Compare by-basin and by-BHI region results for status and for trend, assess number of data points contributing</li>
</ol>
<p><img src="bhi-prep_files/figure-html/investigate%20approaches%20to%20qflags%20and%20summarizing%20by%20region%20vs%20basin%20pfos%20indicator-1.png" width="912" /></p>
<p><br></p>
</div>
<div id="save-pfos-contaminants-layer-and-intermediate-datasets" class="section level4 unnumbered">
<h4>3.1.5 Save PFOS contaminants layer and intermediate datasets</h4>
<p><br></p>
<hr />
</div>
<div id="methods-discussion-1" class="section level4 unnumbered">
<h4>3.1.6 Methods discussion</h4>
<p><strong>Status formula, ICES6 PCBs Biota and 7PCBs in Sediment</strong></p>
<p><strong>Conclusions &amp; Decisions regarding Status and Trend Options</strong></p>
<p><strong>Trend Considerations</strong></p>
<hr />
<p><br></p>
</div>
</div>
<div id="dioxin-indicator" class="section level3 unnumbered">
<h3>3.3 Dioxin Indicator</h3>
<div id="match-bhi-regions-2" class="section level4 unnumbered">
<h4>3.3.1 Match BHI Regions</h4>
<p>Dioxins and dioxin-like PCBs datasets are manipulated as separate objects for the next steps, combined only in the last code chunk before section 3.3.3 ‘Status and Trend Options’. Sediment and biota datasets for each dioxins and dioxin-like PCBs are joined before spatial plotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## use &#39;join_rgns_info&#39; helper function defined in spatial.R
dioxin_bio &lt;-<span class="st"> </span><span class="kw">join_rgns_info</span>(
  <span class="kw">read_clean_df</span>(<span class="st">&quot;dioxin_bio_cleaned.csv&quot;</span>),
  <span class="dt">latlon_vars =</span> <span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>),
  <span class="dt">rgn_shps_loc =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>),
  <span class="dt">return_spatial =</span> <span class="ot">FALSE</span>,
  <span class="dt">buffer_shp =</span> buffer_sf
)
dioxin_sed &lt;-<span class="st"> </span><span class="kw">join_rgns_info</span>(
  <span class="kw">read_clean_df</span>(<span class="st">&quot;dioxin_sed_cleaned.csv&quot;</span>),
  <span class="dt">latlon_vars =</span> <span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>),
  <span class="dt">rgn_shps_loc =</span> <span class="kw">file.path</span>(<span class="kw">dirname</span>(dir_B), <span class="st">&quot;Shapefiles&quot;</span>),
  <span class="dt">return_spatial =</span> <span class="ot">FALSE</span>,
  <span class="dt">buffer_shp =</span> buffer_sf
)</code></pre></div>
<p><br></p>
</div>
<div id="filter-dioxin-like-pcbs-to-join-with-dioxins-dataset-and-convert-all-to-toxic-equivalents" class="section level4 unnumbered">
<h4>3.3.2 Filter Dioxin-like PCBs to join with Dioxins dataset, and Convert all to Toxic Equivalents</h4>
<p>To convert dioxin and dioxin-like PCB congener concentrations to toxic equivalents we use the <a href="https://www.who.int/ipcs/assessment/tef_values.pdf">IPCS Reference Table</a>, taken from The 2005 World Health Organization Re-evaluation of Human and Mammalian Toxic Equivalency Factors for Dioxins and Dioxin-like Compounds (Van den Berg et al, 2005).</p>
<p><strong>Filter PCB to keep only dioxin-like PCBs, convert units, and convert to TEQ</strong></p>
<p><strong>Use TEF conversion factor to convert Dioxin concentrations to TEQ</strong></p>
<div id="checking-outliersquestionable-measurements-.tabset-.tabset-fade-.tabset-pills-1" class="section level5 unnumbered">
<h5>Checking Outliers/Questionable Measurements {.tabset .tabset-fade .tabset-pills}</h5>
<div id="dioxin-like-pcbs-in-biota" class="section level6 unnumbered">
<h6>Dioxin-like PCBs in Biota</h6>
<p><img src="bhi-prep_files/figure-html/checking%20dioxinlike%20pcb%20bio%20data%20and%20outliers-1.png" width="960" /></p>
<hr />
<p><br></p>
</div>
<div id="dioxin-like-pcbs-in-sediment" class="section level6 unnumbered">
<h6>Dioxin-like PCBs in Sediment</h6>
<p><img src="bhi-prep_files/figure-html/checking%20dioxinlike%20pcb%20sed%20data%20and%20outliers-1.png" width="960" /></p>
<hr />
<p><br></p>
</div>
<div id="dioxins-in-biota" class="section level6 unnumbered">
<h6>Dioxins in Biota</h6>
<p><img src="bhi-prep_files/figure-html/checking%20dioxin%20biota%20data%20and%20outliers-1.png" width="960" /></p>
<p><br></p>
</div>
</div>
</div>
<div id="status-and-trend-options-2" class="section level4 unnumbered">
<h4>3.3.4 Status and Trend Options</h4>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Subbasin
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_Adjusted
</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
lastyr_NoQflag
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Aland Sea
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2017
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Arkona Basin
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Bay of Mecklenburg
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2008
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2008
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Bornholm Basin
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Bothnian Bay
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2018
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2018
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Bothnian Sea
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2018
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Eastern Gotland Basin
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2016
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2016
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Great Belt
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2015
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2015
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Gulf of Finland
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2018
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2018
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Gulf of Riga
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2018
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Kattegat
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2017
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
Kiel Bay
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2011
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2011
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
Northern Baltic Proper
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2017
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: left;">
The Quark
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; text-align: center;">
2017
</td>
</tr>
<tr>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: left;">
The Sound
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; text-align: center;">
2015
</td>
<td style="padding-left: 10em; padding-right: 1.5em; text-align: center;">
2015
</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: left;">
Western Gotland Basin
</td>
<td style="padding-left: 5.75em; padding-right: 1.5em; background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">
2017
</td>
<td style="padding-left: 10em; padding-right: 1.5em; background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">
2017
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>Compare two approaches to deal with flagged data, for BHI regions vs Basin</strong></p>
<ol style="list-style-type: decimal">
<li>Start with total TEQs: congeners summed per sample, means by date and location, dioxin and dioxin-like PCB summes added together per unique date and location<br />
</li>
<li>Take mean of all unique obs. for latest 5 years in either BHI region or basin</li>
<li>Compare by-basin and by-BHI region results for status and for trend, assess number of data points contributing</li>
</ol>
<p><img src="bhi-prep_files/figure-html/investigate%20approaches%20to%20qflags%20and%20summarizing%20by%20region%20vs%20basin%20dioxin%20indicator-1.png" width="912" /></p>
<p><br></p>
</div>
<div id="save-dioxin-contaminants-layer-and-intermediate-datasets" class="section level4 unnumbered">
<h4>3.3.5 Save Dioxin contaminants layer and intermediate datasets</h4>
<p><br></p>
<hr />
</div>
<div id="methods-discussion-2" class="section level4 unnumbered">
<h4>3.3.6 Methods discussion</h4>
<p><strong>Status formula</strong></p>
<p><span class="math inline">\(X_{dioxinTEQ} = \min\{1, \mbox{ teq threshold}/\mbox{mean dioxin-like pcb teq value}\}\)</span></p>
<p><strong>Conclusions &amp; Decisions regarding Status and Trend Options</strong></p>
<p><strong>Trend Considerations</strong></p>
<hr />
</div>
</div>
<div id="concerning-substances-indicator" class="section level3 unnumbered">
<h3>3.4 Concerning Substances Indicator</h3>
<p>This indicator is a new addition since the <code>BHI1.0</code>, conceptualized as a more comprehensive way to account for the fact that many concerning, hazardous substances are not currently monitored in the Baltic Sea. In the earlier assessment, a penalty factor of 0.1 was applied to the entire Baltic to reduce the contaminant subgoal scores so they better reflected this concerning situation. This method uses <a href="https://echa.europa.eu/candidate-list-table?p_p_id=disslists_WAR_disslistsportlet&amp;p_p_lifecycle=1&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_pos=2&amp;p_p_col_count=3&amp;_disslists_WAR_disslistsportlet_javax.portlet.action=searchDissLists">a list compiled by ECHA of concerning substances</a>, and involves cross-referencing with those monitored substances in the <a href="http://dome.ices.dk/views/ContaminantsBiota.aspx">ICES contaminants databases for biota</a> <a href="http://dome.ices.dk/views/ContaminantsSediment.aspx">and for sediments</a>. Those on the list which are monitored, are assessed for spatial coverage of monitoring; substances on the list may be monitored somewheree in the Baltic Sea, but only in some basins or for some countries. The final indicator score is the percentage of substances on the list that are monitored in the given region.</p>
</div>
<div id="regional-monitoring-of-concerning-substances" class="section level3 unnumbered">
<h3>3.4.1 Regional monitoring of Concerning Substances</h3>
<p>Of the concerning substances which are monitored, some are monitored only in some BHI regions and/or years. The code below is used in assessing this spatial coverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## read in master table of emerging contaminant
## this was compiled by Andrea and checked by Anna Sobeck for correctness/completeness
data_loc &lt;-<span class="st"> </span><span class="kw">file.path</span>(dir_B, <span class="st">&quot;Goals&quot;</span>, <span class="st">&quot;CW&quot;</span>, <span class="st">&quot;CON&quot;</span>)
subst_of_concern &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(data_loc, <span class="st">&quot;concerning_substances_lookup.csv&quot;</span>))

## spatial regions table for joining
joindf &lt;-<span class="st"> </span>BHI_rgns_shp <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">st_drop_geometry</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Area_km2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Subbasin =</span> <span class="kw">as.character</span>(Subbasin), 
    <span class="dt">HELCOM_ID =</span> <span class="kw">as.character</span>(HELCOM_ID),
    <span class="dt">rgn_nam =</span> <span class="kw">as.character</span>(rgn_nam), 
    <span class="dt">rgn_key =</span> <span class="kw">as.character</span>(rgn_key)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">list</span>(<span class="dv">1990</span><span class="op">:</span><span class="dv">2020</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>tidyr<span class="op">::</span><span class="kw">unnest</span>(year)

## loop through substances and determine which regions they are/not monitored in
rgn_monitor_bio_allsubst &lt;-<span class="st"> </span>joindf
rgn_monitor_sed_allsubst &lt;-<span class="st"> </span>joindf
plotlistbio &lt;-<span class="st"> </span><span class="kw">list</span>()
plotlistsed &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="cf">for</span>(nm <span class="cf">in</span> <span class="kw">unique</span>(<span class="kw">filter</span>(subst_of_concern, ICES_monitored)<span class="op">$</span>filename)){
  
  bio_fp &lt;-<span class="st"> </span><span class="kw">file.path</span>(
    data_loc, 
    <span class="st">&quot;ContaminantsBiota_ConcerningSubstances&quot;</span>, 
    <span class="kw">sprintf</span>(<span class="st">&quot;ContaminantsBiota_%s.csv&quot;</span>, nm)
  )
  sed_fp &lt;-<span class="st"> </span><span class="kw">file.path</span>(
    data_loc,
    <span class="st">&quot;ContaminantsSediment_ConcerningSubstances&quot;</span>, 
    <span class="kw">sprintf</span>(<span class="st">&quot;ContaminantsSediment_%s.csv&quot;</span>, nm)
  )
  
  <span class="cf">if</span>(<span class="kw">file.exists</span>(bio_fp)){
    regionalmonitoringbio &lt;-<span class="st"> </span><span class="kw">get_spatial_monitor_info</span>(
      bio_fp,
      <span class="dt">matrix =</span> <span class="st">&quot;bio&quot;</span>,
      <span class="dt">bhi_join_tab =</span> joindf
    )
    <span class="kw">colnames</span>(regionalmonitoringbio<span class="op">$</span>monitored) &lt;-<span class="st"> </span><span class="kw">names</span>(regionalmonitoringbio<span class="op">$</span>monitored) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">str_replace</span>(<span class="st">&quot;ICES_monitored&quot;</span>, <span class="kw">paste</span>(nm, <span class="st">&quot;monitored&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))

    rgn_monitor_bio_allsubst &lt;-<span class="st"> </span>rgn_monitor_bio_allsubst <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">left_join</span>(regionalmonitoringbio<span class="op">$</span>monitored)
    
    plotlistbio[[nm]] &lt;-<span class="st"> </span>regionalmonitoringbio<span class="op">$</span>obscounts
  }
  <span class="cf">if</span>(<span class="kw">file.exists</span>(sed_fp)){
    regionalmonitoringsed &lt;-<span class="st"> </span><span class="kw">get_spatial_monitor_info</span>(
      sed_fp,
      <span class="dt">matrix =</span> <span class="st">&quot;sed&quot;</span>,
      <span class="dt">bhi_join_tab =</span> joindf
    )
    <span class="kw">colnames</span>(regionalmonitoringsed<span class="op">$</span>monitored) &lt;-<span class="st"> </span><span class="kw">names</span>(regionalmonitoringsed<span class="op">$</span>monitored) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">str_replace</span>(<span class="st">&quot;ICES_monitored&quot;</span>, <span class="kw">paste</span>(nm, <span class="st">&quot;monitored&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))
    
    rgn_monitor_sed_allsubst &lt;-<span class="st"> </span>rgn_monitor_sed_allsubst <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">left_join</span>(regionalmonitoringsed<span class="op">$</span>monitored)
    
    plotlistsed[[nm]] &lt;-<span class="st"> </span>regionalmonitoringsed<span class="op">$</span>obscounts
  }
}

## for the remaining substances of concern (not monitored at all) create columns
<span class="cf">for</span>(s <span class="cf">in</span> <span class="kw">unique</span>(<span class="kw">filter</span>(subst_of_concern, <span class="op">!</span>ICES_monitored)<span class="op">$</span>filename)){
  ## add to bio dataset
  dfbio &lt;-<span class="st"> </span><span class="kw">mutate</span>(rgn_monitor_bio_allsubst, <span class="dt">addcolumn =</span> <span class="ot">FALSE</span>)
  <span class="kw">colnames</span>(dfbio) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">names</span>(rgn_monitor_bio_allsubst), <span class="kw">paste0</span>(s, <span class="st">&quot;_monitored&quot;</span>))
  rgn_monitor_bio_allsubst &lt;-<span class="st"> </span>dfbio
  ## add to sed dataset
  dfsed &lt;-<span class="st"> </span><span class="kw">mutate</span>(rgn_monitor_sed_allsubst, <span class="dt">addcolumn =</span> <span class="ot">FALSE</span>)
  <span class="kw">colnames</span>(dfsed) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">names</span>(rgn_monitor_sed_allsubst), <span class="kw">paste0</span>(s, <span class="st">&quot;_monitored&quot;</span>))
  rgn_monitor_sed_allsubst &lt;-<span class="st"> </span>dfsed
}
## join and spread so can easily sum num. substances monitored
rgn_monitor_allsubst &lt;-<span class="st"> </span><span class="kw">full_join</span>(
  rgn_monitor_bio_allsubst <span class="op">%&gt;%</span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(
      <span class="dt">cols =</span> <span class="kw">ends_with</span>(<span class="st">&quot;_monitored&quot;</span>), 
      <span class="dt">names_to =</span> <span class="st">&quot;substance&quot;</span>, 
      <span class="dt">values_to =</span> <span class="st">&quot;bio_monitored&quot;</span>
    ),
  rgn_monitor_sed_allsubst <span class="op">%&gt;%</span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(
      <span class="dt">cols =</span> <span class="kw">ends_with</span>(<span class="st">&quot;_monitored&quot;</span>), 
      <span class="dt">names_to =</span> <span class="st">&quot;substance&quot;</span>, 
      <span class="dt">values_to =</span> <span class="st">&quot;sed_monitored&quot;</span>
    )
)
rgn_monitor_allsubst &lt;-<span class="st"> </span>rgn_monitor_allsubst <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">monitored =</span> bio_monitored<span class="op">|</span>sed_monitored) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">monitored =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(monitored), <span class="ot">FALSE</span>, monitored)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>bio_monitored, <span class="op">-</span>sed_monitored) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">substance =</span> <span class="kw">str_remove</span>(substance, <span class="st">&quot;_monitored&quot;</span>))

<span class="co"># gridExtra::grid.arrange(grobs = plotlistbio, nrow = length(plotlistbio))</span>
<span class="co"># gridExtra::grid.arrange(grobs = plotlistbio, nrow = length(plotlistsed))</span></code></pre></div>
</div>
<div id="save-concerning-substances-layer-and-intermediate-datasets" class="section level3 unnumbered">
<h3>3.4.2 Save concerning substances layer and intermediate datasets</h3>
<p>The data layer for the concerning substances indicator contains true/false records per BHI region per year for each of the 35 distinct substances on the <a href="https://echa.europa.eu/candidate-list-table?p_p_id=disslists_WAR_disslistsportlet&amp;p_p_lifecycle=1&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_pos=2&amp;p_p_col_count=3&amp;_disslists_WAR_disslistsportlet_javax.portlet.action=searchDissLists">European Chemical Agency Candidate List of substances of very high concern for Authorisation</a>.</p>
<hr />
</div>
</div>
<div id="visualizing-contaminants-data-layers" class="section level2 unnumbered">
<h2>4. Visualizing Contaminants Data Layers</h2>
<div id="contaminants-data-layers-maps-subbasin-trends" class="section level3 unnumbered">
<h3>4.1 Contaminants data layers Maps &amp; Subbasin Trends</h3>
<p>Maps on the left show each indicator’s status individually, and the larger map on the right shows the combined status score with PCB, PFOS, and Dioxin indicators averaged and penalized by the Concerning Substances indicator (monitored proportion).</p>
<p><img src="bhi-prep_files/figure-html/visualize%20con%20data%20layers%20and%20trends-1.png" width="912" /></p>
<p><br></p>
</div>
</div>
<div id="considerations-for-bhi3.0" class="section level2 unnumbered">
<h2>5. Considerations for <code>BHI3.0</code></h2>
<p>From the ICES Organofluorines dataset, include PFAS in addition to PFOS. To include PFAS, a suitable reference point will need to be found.</p>
<p><br></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>6. References</h2>
<p><a href="http://www.diva-portal.org/smash/record.jsf?pid=diva2%3A728508&amp;dswid=1554">Faxneld et al. 2014a</a> Biological effects and environmental contaminants in herring and Baltic Sea top predators</p>
<p><a href="https://www.diva-portal.org/smash/get/diva2:767385/FULLTEXT01.pdf">Faxneld et al. 2014b</a> Distribution of PFAS in liver and muscle of herring, perch, cod, eelpout, arctic char, and pike from limnic and marine environments in Sweden.</p>
<p><a href="http://pubs.rsc.org/en/Content/ArticleLanding/2007/EM/b700667e#!divAbstract">Bignert, A., Nyberg, E., Sundqvist, K.L., Wiberg, K., 2007.</a> Spatial variation in concentrations and patterns of the PCDD/F and dioxin-like PCB content in herring from the northern Baltic Sea. J. Environ. Monit. 9, 550–556.</p>
<p><a href="http://helcom.fi/helcom-at-work/groups/state-and-conservation">Working Group on the State of the Environment and Nature Conservation</a></p>
<p><a href="http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2011:320:0018:0023:EN:PDF">Commission Regulation (EU) No. 1259/2011 of 2 December 2011.</a> Amending Regulation (EC) No 1881/2006 as regards maximum levels for dioxins, dioxin-like PCBs and non dioxin-like PCBs in foodstuffs.</p>
<p><a href="http://www.who.int/ipcs/assessment/tef_values.pdf">Van den Berg et al, World Health Organization 2005.</a> The 2005 World Health Organization Re-evaluation of Human and Mammalian Toxic Equivalency Factors for Dioxins and Dioxin-like Compounds.</p>
<p><a href="http://www.helcom.fi/Core%20Indicators/PFOS_HELCOM%20core%20indicator%202016_web%20version.pdf">HELCOM PFOS core indicator document</a></p>
<p><a href="https://www.miljodirektoratet.no/globalassets/publikasjoner/m1132/m1132.pdf">Norwegian environment agency, PCBs and Dioxins indicator in sediment</a></p>
<p><a href="http://www.vannportalen.no/globalassets/nasjonalt/dokumenter/veiledere-direktoratsgruppa/Klassifisering-av-miljotilstand-i-vann-02-2018.pdf">Norwegian Environmental quality classification of water bodies</a></p>
<p><br></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wild-caught-fisheries-food-provision-subgoal.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
