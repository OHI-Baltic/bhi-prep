
## 2. Data

```{r Preamble, echo = FALSE, include = FALSE, error = FALSE}
source(here::here("R", "data.R"))
```

For the Eutrophication sub-goal five indicators were included:

-   winter (December-February) dissolved inorganic nitrogen (DIN) concentrations in the surface layer (0 - 10 m depth)
-   winter (December-February) dissolved inorganic phosphorus (DIP) concentrations in the surface layer (0 - 10 m depth)
-   summer (June-September) chlorophyll a concentration in the surface layer (0 - 10 m depth)
-   summer (June-September) Secchi depth,
-   oxygen debt (hypoxic area below the halocline).

### 2.1 Datasets with Sources
<br/>

#### 2.1.1. Secchi Depth data

**Secchi Depth, ICES**
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/EUT/ -->

Extraction from ICES database is classified into HELCOM Assessment Units – HELCOM sub basins with coastal WFD water bodies or water types

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Dataset set:", "Oceanographic (per Parameter)"), 
  c("Parameter:", "secchi depth (Download)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [ICES data portal](http://ecosystemdata.ices.dk/inventory/Index.aspx?) <br/> Requested 24 Feb 2020 by Andrea De Cervo and received 24 Feb 2020 by Else Juul Green") 
```
*must request all records as web download limited to max 10000 records per layer*

<br/>

**Secchi Depth, SMHI**  
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/EUT/SecchiDepth_SMHI -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Datatype:", "Physical and Chemical"), 
  c("Parameter:", "secchi depth"),
  c("Months:", "All"),
  c("Years:", "1893-2019 (all listed; though goes back only to 1967 in downloaded dataset)"),
  c("Decimal/fält-avgränsare (decimal/delimiter):", "punkt/semikolon (period/semicolon)"),
  c("Teckenkodning:", "UTF-8"),
  c("Rubrikrad:", "Englelska (English)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [SMHI Shark database](http://www.smhi.se/klimatdata/oceanografi/havsmiljodata/marina-miljoovervakningsdata) <br/> Downloaded 22 April 2019 by Ellie Campbell")
```
<br/>

#### 2.1.2. Oxygen debt

**Oxygen debt**
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/EUT/??? -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Period:", "2010-2020"), 
  c("Parameter:", "Oxygen"),
  c("Country:", "(choose each Baltic country at a time)"),
  c("Ship:", "Any")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [ICES database](https://ocean.ices.dk/HydChem/HydChem.aspx?plot=yes) <br/> Downloaded 27 February 2020 by Andrea De Cervo")
```
<br/>

#### 2.1.3. Chlorophyll A, and Nutrients (DIN and DIP)

**Chlorophyll A and Nutrients, Baltic Nest**
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/EUT/NestData/nestdata_winter_nutrients.csv -->
<!-- dataset save location BHI_share/BHI 2.0/Goals/CW/EUT/NestData/nestdata_summer_chlorophyl.csv -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Latitude/Longitude Begin/End:", "Baltic Sea"), 
  c("Dates Begin/End:", "Jan 1, 2005 to Dec 31, 2019"), 
  c("Parameters:", "PO4P, NO3N, NO2N, NO23N, NH4N, CHL")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Baltic Nest database](http://nest.su.se/dataPortal/getStations) <br/> Downloaded 28 February 2020 by Ellie Campbell. See data.R/get_nest_data function for more detailed info.")
```

```{r using get_nest_data function to download winter nutrient data, eval = FALSE}
get_nest_data(date_range = c(20050101,20191231), months = c(11,12,1:3), param_codes = c("NO3N","NO2N","NO23N","NH4N","TOTN","PO4P")) %>% 
    readr::write_csv(file.path(dir_B, "Goals", "EUT", "NestData", "nestdata_winter_nutrients.csv"))
```

```{r using get_nest_data function to download summer chlorophyl A data, eval = FALSE}
get_nest_data(date_range = c(20050101, 20191231), months = 5:10, param_codes = c("CHL")) %>% 
    readr::write_csv(file.path(dir_B, "Goals", "EUT", "NestData", "nestdata_summer_chlorophyl.csv"))
```


<br/>

#### 2.1.5. Threshold values

The threshold values have been agreed on by HELCOM and by Heads of Delegation (HOD) and the applied threshold values for core and pre-core indicators in the HELCOM open sea assessment units are presented in the [Baltic Sea Environment Proceedings no.156](http://stateofthebalticsea.helcom.fi/wp-content/uploads/2019/09/BSEP156-Eutrophication.pdf) (p.10, Table 2).


### 2.2 Centralization & Normalization

**Read Secchi data**
```{r read raw datasets, message = FALSE, warning = FALSE, echo = TRUE, results = "hide"}

## root location of the raw data
dir_B <- file.path(dirname(dir_prep), "bhi-data", "BHI 2.0")
dir_rawdata <- file.path(dir_B, "Goals", "CW", "EUT")

## read in secchi data
secchi_raw_ices <- read.delim(file.path(dir_rawdata, "SecchiDepth_ICES", "SecchiDepth_ICES.csv"), sep = ";")
secchi_raw_smhi <- read.delim(file.path(dir_rawdata, "SecchiDepth_SMHI", "SecchiDepth_SMHI.csv"), sep = ";")

# Data overview
colnames(secchi_raw_ices)
str(secchi_raw_ices)

colnames(secchi_raw_smhi)
str(secchi_raw_smhi)
```



### 2.3 Initial Data Exploration

#### 2.3.1 Compare versus Previous Years Data

#### 2.3.2 Timeseries Plots

#### 2.3.3 Map
