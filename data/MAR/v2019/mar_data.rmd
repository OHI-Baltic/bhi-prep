## 2. Data

**Rainbow trout production (Denmark, Sweden and Finland) and Finfish (Denmark, Germany, Sweden and Finland)**

```{r Preamble, echo = FALSE, include = FALSE, error = FALSE}
source(file.path(here::here(), "R", "setup.R"))
# source(file.path(here::here(), "R", "data.R"))
```

### 2.1 Datasets with Sources

**Rainbow trouts mariculture**  

- **Sweden**
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/rb_trout/rbt_swe -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("PDF:", "Vattenbruk 2018"), 
  c("Location data:", "Page 7, table A")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Jorbruksverket database](https://www.scb.se/hitta-statistik/statistik-efter-amne/jord-och-skogsbruk-fiske/vattenbruk/vattenbruk/) <br/> [Jorbruksverket](https://www.scb.se/contentassets/cef2fb103630496bb532e76c98f747e6/jo1201_2018a01_sm_jo60sm1901.pdf) Downloaded 2019-10-09 by Andrea De Cervo")
```

<br/>

- **Denmark**
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/rb_trout/rbt_den -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Faste tabeller med akvakulturststistik:", "Produktion af hovedarter fordelt på region"), 
  c("Rows:", "Regnbueørred, Saltvand")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Ministry of Environment and Food of Denmark database](https://fiskeristyrelsen.dk/fiskeristatistik/akvakulturstatistik/) <br/> Downloaded 2019-10-11 by Andrea De Cervo")
```

<br/>

- **Finland**
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/rb_trout/rbt_fin -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Luke statistics database:", "Food fish production by species"), 
  c("Production:", "Quantity (1 000 kg)"),
  c("Area:", "Sea"),
  c("Fish:", "Rainbow trout"),
  c("Year:", "All")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Natural Resources Institute database](http://statdb.luke.fi/PXWeb/pxweb/en/LUKE/LUKE__06%20Kala%20ja%20riista__02%20Rakenne%20ja%20tuotanto__10%20Vesiviljely/?tablelist=true&rxid=ef8a2896-d6cb-4660-a8aa-fee93bd4212f) <br/> Downloaded 2019-10-10 by Andrea De Cervo")
```

<br/>

- **Germany**
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/rb_trout/rbt_ger -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Location:", "Kiel Bay")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Email from plant manager](tassilo@jaeger-kleinicke.de) <br/> Received 2019-10-30")
```

<br/>

**Finfish Mariculture**  
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/Finfish_mariculture -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("HELCOM Map and Data service:", "Pressures and human activities"), 
  c("Human activities:", "Finfish mariculture")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM database](http://maps.helcom.fi/website/mapservice/?datasetID=3cfa469a-6a78-4913-b82f-57fd0e7f4dc0) <br/> (http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/3cfa469a-6a78-4913-b82f-57fd0e7f4dc0) <br/> Downloaded 2019-10-09 by Andrea De Cervo")
```

<br/>

**All Baltic countries**
<!-- dataset save location BHI_share/2.0/Goals/FP/Mariculture/FAO_fishstat -->

```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("FAO FishStatJ:", "Global aquaculture production"), 
  c("Quantity:", "1950-2017")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [FAO FishStatJ](http://www.fao.org/fishery/statistics/software/fishstatj/en#downlApp) <br/> Downloaded 2019-10-16 by Andrea De Cervo")
```

<br/>

#### Reference Point: maximum nutrient discharge (N/P)

In 2016 HELCOM Contracting Parties adopted Recommendation 37/3 on "Sustainable aquaculture in the Baltic Sea Region" (http://www.helcom.fi/Recommendations/Rec%2037-3.pdf). 

However, the only parameter that can be used as reference point for Mariculture in the Baltic Sea (that can be also found on Finnish Mariculture data provided by HELCOM) is the maximum nutrient discharge for P and N:
http://www.helcom.fi/Recommendations/Rec%2025-4.pdf

where existing and new marine fish farms should not exceed the annual average of: 
- 7g of P (tot-P) 
- 50g of N (tot-N) 
per 1kg fish (living weight) produced.
[The nutrient limit values (P and N) are calculated on the basis that living fish contains 0,4% of phosphorus and 2,75% of nitrogen.]

This recommendation was adopted in 2004, but since there are not updated nutirent limit values, this will be the parameter used as reference point.

### 2.2 Centralization & Normalization

```{r load raw data, message = FALSE, warning = FALSE, echo = TRUE}
## root location of the raw data
dir_rawdata <- file.path(dir_B, "Goals", "FP", "MAR") # list.files(dir_rawdata)

## rainbow trout data
library(readr)
rbt_de_raw <- read_delim(file.path(dir_rawdata, "rbt_de", "rbt_de.csv"), delim = ";")

rbt_dk_raw <- read_delim(file.path(dir_rawdata, "rbt_dk", "rbt_dk.csv"), delim = ";")
rbt_dk2005raw <- read_delim(file.path(dir_rawdata, "rbt_dk", "rbt_dk_2005.csv"), delim = ";")

rbt_fi_raw <- read_delim(file.path(dir_rawdata, "rbt_fi", "rbt_fi.csv"), delim = ";")
rbt_se_raw <- read_delim(file.path(dir_rawdata, "rbt_se", "rbt_se.csv"), delim = ";")

## FAO rainbow trout data
fao_rbt_raw <- read_delim(file.path(dir_rawdata, "FAO_fishstat", "FAO_fishstat.csv"), delim = ";")
  
## HELCOM Finfish mariculture data
finfish_mariculture_raw <- sf::st_read(file.path(dir_rawdata,
  "Finfish_mariculture", "Finfish_mariculture.shp")) # load library(sf)

# testing tidy finfish mariculture 
f <-finfish_mariculture_raw %>% 
    dplyr::rename(
    area = SUBBASIN,
    farm_species = PRODUCTION,
    country = COUNTRY) %>% 
    select(COUNTY & country == SE,
           -NAME, -COMMENTS) %>%
    tidyr::gather(key = "year", value = "produced_tonnes", -area, -farm_species) %>% 
    filter(farm_species == "Rainbow trout", 
         !(environment == "Marine" & area == "Denmark")) %>% 

    
```

#### 2.2.0 Merge datasets and calculate maximum nutrient discharge (N/P) 

```{r merge datasets and calculate max nutrient input, echo = TRUE}
combined_rawdata2 <- rbind(
  ## rbt_de
  rbt_de_raw %>% 
    dplyr::rename(farm_species = production) %>% 
    tidyr::gather(key = "area", value = "produced_tonnes", -year, -farm_species) %>%
    dplyr::mutate(country = "DE") %>%
    dplyr::mutate(produced_tonnes = as.numeric(produced_tonnes)
    ),
  ## rbt_dk2005 
  rbt_dk2005raw %>% 
    dplyr::select(-tot_wt_ton) %>% 
    dplyr::rename(
      farm_species = production,
      arhus_cty = cty1, 
      vejle_cty = cty2,
      fyns_cty = cty3,
      sønderjylland_cty = cty4,
      ribe_cty = cty5,
      ringkøbing_cty = cty6,
      viborg_cty = cty7,
      nordjyllands_cty = cty8,
      frederiksborg_cty = cty9,
      roskilde_cty = cty10,
      storstrøms_cty  = cty11,
      vestsjællands_cty = cty12
    ) %>% 
    tidyr::gather(key = "area", value = "produced_tonnes", -year, -farm_species) %>% 
    dplyr::mutate(country = "DK"),
  ## rbt_dk 
  rbt_dk_raw %>% 
    dplyr::rename(
      farm_species = production,
      denmark = tot_wt_ton,
      hovedstaden = "reg1", 
      sjælland = "reg2",
      syddanmark = "reg3",
      midtjylland = "reg4",
    ) %>% 
     tidyr::gather(key = "area", value = "produced_tonnes", -year, -farm_species) %>% 
    dplyr::mutate(country = "DK"),
   ## rbt_fi
  rbt_fi_raw %>% 
    dplyr::mutate(country = "FI", area = "finland") %>%  
    dplyr::rename(
      produced_tonnes = tot_wt_tonnes, 
      farm_species = production
    ),
  ## rbt_se
  rbt_se_raw %>% 
    dplyr::rename(
      farm_species = production,
      sweden = tot_wt_mtonnes) %>% 
    select(-ne_farm_no, -other_farm_no) %>%  # don't need these information 
    tidyr::gather(key = "area", value = "produced_tonnes", -year, -farm_species) %>% 
    mutate(country = "SE"),
  ## fao_rbt
  fao_rbt_raw %>% 
    dplyr::rename(
    area = country,
    farm_species = species) %>% 
    filter(farm_species == "Rainbow trout", 
         !(environment == "Marine" & area == "Denmark")) %>% 
    select(-aqua_area, -Unit, -environment) %>%
    tidyr::gather(key = "year", value = "produced_tonnes", -area, -farm_species) %>% 
    mutate(country = "DK", area = "Denmark",
           country = "ES", area = "Estonia",
           country = "FI", area = "Finland",
           country = "DE", area = "Germany",
           country = "SE", area = "Sweden"),
  ## finfish mariculture
  finfish_mariculture_raw %>% 
    dplyr::rename(
    area = SUBBASIN,
    farm_species = PRODUCTION,
    country = COUNTRY) %>% 
    filter(farm_species == "Rainbow trout", 
         !(environment == "Marine" & area == "Denmark")) %>% 
    select(-aqua_area, -Unit, -environment) %>%
    tidyr::gather(key = "year", value = "produced_tonnes", -area, -farm_species) %>% 
    mutate(country = "DK", area = "Denmark",
           country = "ES", area = "Estonia",
           country = "FI", area = "Finland",
           country = "DE", area = "Germany",
           country = "SE", area = "Sweden"))
      
```

Then add the max nutrient input value: 
- 7g of P (tot-P) 
- 50g of N (tot-N) 
per 1kg fish (living weight) produced --> 

--> 7g of P per 1kg fish = 7kg of P per 1ton fish
--> 50g of N per 1kg fish = 50kg of N per 1ton fish

```{r}

## join with max nutrient input value
 
```


#### 2.2.1 Standardize Units

#### 2.2.2 Rename Fields/Variables

#### 2.2.3 Save to BHI Database

<br/>

### 2.3 Initial Data Exploration

#### 2.3.1 Compare versus Previous Years Data

#### 2.3.2 Timeseries Plots

#### 2.3.3 Map

