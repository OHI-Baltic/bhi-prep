---
title: "Carbon Storage (CS) Goal Data Prep"
output:
  github_document:
    toc: true
    toc_depth: 3
params: 
    datasource: csv
always_allow_html: true
---


```{r cs preamble, echo = FALSE, include = FALSE, error = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = TRUE, results = "show", fig.width = 9.5, fig.height = 6)
source(here::here("R", "setup.R"))
source(here::here("R", "spatial.R"))

dir <- here::here("prep", "CS", "v2021")
bkgd_path <- here::here("supplement", "goal_summaries", "CS.Rmd")
glossary_path <- here::here("supplement", "glossary.Rmd")
```

<br>

## 1. Background

```{r glossary, child = glossary_path, results = "asis", echo = FALSE}
```

<br>

```{r cs background, child = bkgd_path, results = "asis", echo = FALSE}
```

<br/>

## 2. Data

This prep document is used to generate and explore the following data layers:

- `LAYER1_bhi2019.csv` 
- `LAYER2_bhi2019.csv` 
- `LAYER3_bhi2019.csv` 

These are saved to the `layers` folder. Saved to `prep/CS/v2021/intermediate` are intermediate datasets: `DATASETINTEMED1.csv` and `DATASETINTEMED2.csv`. All these are derived from or informed by the raw datasets from RAW DATA SOURCES.

<br>

### 2.1 Datasets with Sources
<br/>

#### 2.1.1 Macrophytes Data {-}

**Zostera marina observations (LC)**

Observations of Zostera marina were collected from the Baltic Sea area for HELCOM Red List species list.
Zostera marina has been placed to the Red List category of Least Concern (LC) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Least Concern (LC)"),
  c("Least Concern (LC)", "Zostera marina (LC)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/dd90a6aa-1d65-4158-a2e7-7ca3ee87d615) <br/> Downloaded 23 February 2021 by Andrea De Cervo")
```

---

<br/>

**Chara connivens observations (LC)**

Observations of Chara connivens were collected from the Baltic Sea area for HELCOM Red List species list.
Chara connivens has been placed to the Red List category of Least Concern (LC) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Least Concern (LC)"),
  c("Least Concern (LC)", "Chara connivens (LC)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/fb24fbca-6c40-4958-9eed-251324fd94c8) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Chara tomentosa observations (LC)**

Observations of Chara tomentosa were collected from the Baltic Sea area for HELCOM Red List species list.
Chara tormentosa has been placed to the Red List category of Least Concern (LC) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Least Concern (LC)"),
  c("Least Concern (LC)", "Chara tormentosa (LC)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/906e22f0-6145-4c3c-8eac-cdc4b27aa476) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Furcellaria lumbricalis observations (LC)**

Observations of Furcellaria lumbricalis were collected from the Baltic Sea area for HELCOM Red List species list.
Furcellaria lumbricalis has been placed to the Red List category of Least Concern (LC) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Least Concern (LC)"),
  c("Least Concern (LC)", "Furcellaria lumbricalis (LC)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/cbfc8cc7-b9db-48e2-940f-22c2f8b10c9d) <br/> Downloaded 23 Febryary 2021 by Andrea De Cervo") 
```

<br/>

**Chara horrida observations (NT)**

Observations of Chara horrida were collected from the Baltic Sea area for HELCOM Red List species list.
Chara horrida has been placed to the Red List category of Near threatened (NT) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Near threatened (NT)"),
  c("Near threatened (NT)", "Chara horrida (NT)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/b88e2106-459f-48c6-94e7-5270f4cbc2a5) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Potamogeton friesii observations (NT)**

Observations of Potamogeton friesii were collected from the Baltic Sea area for HELCOM Red List species list.
Potamogeton friesii has been placed to the Red List category of Near threatened (NT) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Near threatened (NT)"),
  c("Near threatened (NT)", "Potamogeton friesii (NT)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/5ee8a00c-bff4-44c8-9f3e-fc00d57e7bb2) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Crassula aquatica observations (NT)**

Observations of Crassula aquatica were collected from the Baltic Sea area for HELCOM Red List species list.
Crassula aquatica has been placed to the Red List category of Near threatened (NT) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Near threatened (NT)"),
  c("Near threatened (NT)", "Crassula aquatica (NT)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/dfeb7c1d-27a7-4687-81d3-279c7eac3641) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Persicaria foliosa observations (EN)**

Observations of Persicaria foliosa were collected from the Baltic Sea area for HELCOM Red List species list.
Persicaria foliosa has been placed to the Red List category of Endangered (EN) species.

Dataset for download contains spatial grid of the Baltic Sea. 
Distribution of the species can be found in corresponding name column. 
Values are coded:
0 = no observations
1 = present before year 1995 or in 1995
2 = present after year 1995
3 = present before and after year 1995

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Red List"), 
  c("Macrophytes:", "Endangered (EN)"),
  c("Endangered (EN)", "Persicaria foliosa (EN)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/52bb349b-04c9-4908-9580-5d7192ba00e2) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

#### 2.1.2 Habitats Data {-}

**Coastal Lagoons (1150)**

Lagoons are expanses of shallow coastal waters, wholly or partially separated from the sea by sandbanks or shingle, or by rocks. The distribution map is based on data submission by HELCOM contracting parties. Most of the submitted data is based on modelling and/or GIS analysis. Data coverage, accuracy and the methods in obtaining the data vary between countries.

Values are coded:
0 = absent
1 = present 

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_habitats -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Natura habitats:", "Coastal lagoons (1150)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/6aaa6eaf-e7f5-4a56-9533-16bc94901a7c) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Large shallow inlets and bays (1160)**

Large shallow inlets bays (according to Habitats Directive Annex I) are large, shallow indentations of the coast, sheltered from wave action and where, in contrast to estuaries, the influence of freshwater is generally limited. The distribution map is based on data submission by HELCOM contracting parties. Most of the submitted data is based on GIS analysis and modelling, but also field inventories and ground-truthing has been carried out in some areas. Data coverage, accuracy and the methods in obtaining the data vary between countries.

Values are coded:
0 = absent
1 = present 

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_habitats -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Natura habitats:", "Large shallow inlets and bays (1160)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/738c72ce-3a67-43c7-9bda-0bff8fdd0303) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Coastal Zones**

Explore the datasets together with the [nomenclature and mapping guidelines](https://land.copernicus.eu/user-corner/technical-library/coastal-zones-nomenclature-and-mapping-guideline.pdf) for in-depth information.

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/Copernicus_coastal_zones -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Natura habitats:", "Large shallow inlets and bays (1160)")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [Copernicus - Land Monitoring Service](https://land.copernicus.eu/local/coastal-zones) <br/> Downloaded 22 February 2021 by Andrea De Cervo") 
```

<br/>


#### 2.1.3 Macrophytes distribution {-}

**Zostera marina distribution**

Distribution of eelgrass based on data submission by HELCOM contracting parties. 
Mainly pointwise occurrences of eelgrass were submitted, originally gathered in national mapping and monitoring campaigns, or for scientific research. Polygon data from Puck Bay (Poland) was digitized based on Polish Marine Atlas and Orlowo cliff area was added based on expert knowledge. From Estonian waters, a predictive model was used (200m resolution), that was converted to presence/absence using minimized difference threshold (MDT) criteria. 
Spatial resolution: 1 km x 1 km grid (originally 5 x 5 km).

Raster value representing presence (1) or absence (0) of Zostera marina.

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Benthic species:", "Zostera marina distribution")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/ca327bb1-d3cb-46c2-8316-f5f62f889090) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Charophyte distribution**

Distribution of Charophytes (Chara spp., Nitella spp., Nitellopsis spp., Tolypella spp.) mainly based on data submission by HELCOM contracting parties. Submitted point data was originally gathered in national mapping and monitoring campaigns, or for scientific research. Also scientific publications were used to complement the data (in Curonian, Vistula and Szczechin lagoons, see reference list). Polygon data from Poland was digitized based on Polish Marine Atlas. From Estonian waters, a predictive model was used (200m resolution), that was converted to presence/absence using minimized difference threshold (MDT) criteria. All data (points, polygon and the raster presenting predicted presence of Charophytes) were generalized to 5km x 5km grid cells.

Raster value representing presence (1) or absence (0) of Charophyte.

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Benthic species:", "Charophyte distribution")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/822ddece-d96a-4036-9ad8-c4b599776eca) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>

**Furcellaria lumbricalis distribution**

Distribution of Furcellaria lumbricalis based on data submission by HELCOM contracting parties. Mainly pointwise occurrences of Furcellaria were submitted, originally gathered in national mapping and monitoring campaigns, or for scientific research purposes. From Estonian waters, a predictive model was used (200m resolution), that was converted to presence/absence using minimized difference threshold (MDT) criteria. For Poland, only confirmed occurrence of Furcellaria were included (Slupsk bansk, Rowy reef and reef at Orlowo cliff). All data (Furcellaria points and the raster presenting predicted presence of Furcellaria) were generalized to 5km x 5km grid cells.

Raster value representing presence (1) or absence (0) of Furcellaria lumbricalis.

<!-- dataset save location BHI_share/BHI 3.0/Goals/CS/HELCOM_species -->
```{r echo = FALSE, results = "asis"}
tab <- t(data.frame(
  c("Biodiversity:", "Ecosystem components (BSII)"), 
  c("Benthic species:", "Furcellaria lumbricalis distribution")))

colnames(tab) <- c("Option", "Specification")
rownames(tab) <- NULL

knitr::kable(tab, caption = "Source: [HELCOM Map and Data Service](http://metadata.helcom.fi/geonetwork/srv/eng/catalog.search#/metadata/363cb353-46da-43f4-9906-7324738fe2c3) <br/> Downloaded 23 February 2021 by Andrea De Cervo") 
```

<br/>


### 2.2 Centralization & Normalization

```{r cs load raw data, echo = TRUE, message = FALSE, warning = FALSE, results = "hide"}
## root location of the raw data
dir_rawdata <- file.path(dir_B, "Goals", "CS")
```

#### 2.2.1 Rename Fields/Variables

#### 2.2.2 Standardize Units

#### 2.2.3 Save to BHI Database

<br/>

### 2.3 Initial Data Exploration

#### 2.3.1 Compare versus Previous Years Data

#### 2.3.2 Timeseries Plots

```{r CODE CHUNK WITH FIGURE OR GRAPH, message = FALSE, echo = TRUE, fig.width = 9.5, fig.height = 4.5}
```

#### 2.3.3 Map


<br/>

## 3. Prep: Wrangling & Derivations, Checks/Evaluation, Gapfilling

<br/>

## 4. Visualizing Data Layers

### 4.1 Map

```{r SOME MAP, message = FALSE, echo = TRUE, fig.width = 9.5}

```

<br>

## 5. Considerations for `BHI4`

<br>

## 6. References


